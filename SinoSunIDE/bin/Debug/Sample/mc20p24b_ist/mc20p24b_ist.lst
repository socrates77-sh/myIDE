L 1				;                                  
L 2				;                                    版权所有(c)赛普微电子
L 3				;*********** 四毛  电暖桌 触摸 控制板 电源板输出控制芯片  
L 4				;产品型号:
L 5				;文件  名:
L 6				;原理图  :
L 7				;MCU     :MC20P24B
L 8				;原始版本: SPW13031P
L 9				;创建  人:唐均
L 10				;创建日期:2013/11/22
L 11				;描　  述: 
L 12				
L 13				;      
L 14				;      
L 15				;    
L 16				;=================================================================================
L 17				;修改时间:
L 18				;版本    :
L 19				;修改  人:
L 20				
L 21				;描　  述: 
L 22				;=================================================================================
L 23				;修改时间: 
L 24				;版本    :
L 25				;修改  人:
L 26				;描　  述: 
L 27				;          
L 28				;          
L 29				;口线分配图:　
L 30				;　　　　　　                   _______　   ______
L 31				;        gnd            vss    ┨1 ●  \___/   20┠   vcc     
L 32				;        guoling        P1.0   ┨2             19┠   P0.0/ad0     
L 33				;        ralay          P1.1   ┨3             18┠   P0.1          
L 34				;                       P1.2   ┨4             17┠   P0.2          
L 35				;                       P2.0   ┨5             16┠   P0.3         
L 36				;        nj_p           P2.1   ┨6             15┠   P0.4          
L 37				;        tao_p          P2.2   ┨7             14┠   P0.5/ad5     yk_int  
L 38				;        you_p          P2.3   ┨8             13┠   P0.6         buzz 
L 39				;        zuo_p          P2.4   ┨9             12┠   P0.7/ad7    
L 40				;        hou_p          P2.5   ┨10            11┠   P2.6/ad8     qian_p    
L 41				;                              ┗━━━━━━━━┛
L 42				;*********************************************************************************
L 43				;*********************************************************************************
L 44				;#include mc20p24.inc
L 45				
L 46				
L 47				
L 48				;=================================================================================
L 49				;特殊RAM:00H---02FH
L 50				    t0c      define    $00      ;t0cnt    t0计数器
L 51				    t0data   define    $01      ;t0data   t0比较值,当t0c递增到=t0data,中断成立
L 52				    t0m      define    $02      ;t0con    t0控制器
L 53				   ;分频 bit7   bit6    ,以系统时钟分
L 54				   ;      0       0     ,fcpu/4096
L 55				   ;      0       1     ,fcpu/256
L 56				   ;      1       0     ,fcpu/8
L 57				   ;      1       1     ,fcpu/1
L 58				   ;bit5  bit4   空
L 59				   t0clr    define     3,t0m    ;=1清t0c(t0cnt)
L 60				   ;bit2         空 
L 61				   t0ie     define     1,t0m    ;=1,t0中断开
L 62				   t0f      define     0,t0m    ;t0中断标志位
L 63				
L 64				    mcr      define    $03      ;lvre低电压检测控制器
L 65				
L 66				    wtdm     define    $0c      ;btcont 看门狗控制,#%10100000即可不开
L 67				    ;bit7   bit6   bit5  bit4
L 68				    ;  1      0     1    0      ;打开
L 69				    ;  0      0     0    0      ;关闭
L 70				    ;bit3   bit2                ;分频
L 71				    ;  0      0                 ;fsys/4096
L 72				    ;  0      1                 ;fsys/1024
L 73				    ;  1      0                 ;fsys/256
L 74				    ;  1      1                 ;fsys/128
L 75				
L 76				    wtdc     define    $0d      ;btcnt 看门狗 
L 77				    p0       define    $10
L 78				    p1       define    $11
L 79				    p2       define    $12
L 80				
L 81				    p0mh     define    $16    ;p0conh,P0高4位控制寄存器
L 82				    p0mL     define    $17    ;p0conh,P0低4位控制寄存器
L 83				    p0int    define    $18    ;p0.0,P0.1外中端控制7器  p0pnd
L 84				    p1m      define    $19    ;p1con,P01控制寄存器
L 85				    p2mh     define    $1a    ;p2conh,P2高4位控制寄存器
L 86				    p2mL     define    $1b    ;p2conh,P2低4位控制寄存器
L 87				
L 88				    pwmc     define    $22    ;pwmdata
L 89				    pwmm     define    $23    ;pwmcon
L 90				
L 91				    adm      define    $27    ;adcon,AD控制寄存器
L 92				   ; 通道选择 bit7  bit6  bit5  bit4
L 93				   ;           0      0    0     0      ;AD0  ,即P0.0脚
L 94				   ; ...........................
L 95				   ;           1      0    0     0      ;AD8
L 96				   feoc     define    3,adm    ;bit3 转换结束标志位
L 97				   ;分频器  bit2  bit1
L 98				   ;          0    0           ;fcpu/8
L 99				   ;          0    1           ;fcpu/4
L 100				   ;...............................
L 101				   fads     define    0,adm    ;bit0 转换启动标志位
L 102				
L 103				    bufadh   define    $28    ;AD转换结果高8位
L 104				    bufadL   define    $29    ;AD转换结果低2位
L 105				;-------------------------------------------------------------------------------
L 106				;口线定义：
L 107				    guoling      define  0,p1             ;过零
L 108				
L 109				    buzz         define  6,p0
L 110				    yk_int       define  5,p0             ; 
L 111				    raly         define  1,p1             ; 
L 112				    nj_p         define  1,p2
L 113				    tao_p        define  2,p2
L 114				    you_p        define  3,p2
L 115				    zuo_p        define  4,p2
L 116				    hou_p        define  5,p2             ;突跳开关检测发码
L 117				    qian_p       define  6,p2
L 118				 
L 119				    
L 120				    ;buz_c        define  5,p0mh   ;P0.6
L 121				    ;zdata_m      define  7,p0mh   ;P0.7
L 122				    ;kdata_m      define  6,p2mh   ;P2.6
L 123				    ;data1629_m   define  3,p2mh   ;P2.5  ,bit3=1输出
L 124				
L 125				    ;bit1int_m    define  2,p1m    ;P1.1  ,bit2=1带上拉的输出
L 126				    ;bit1out_m    define  3,p1m    ;P1.1  ,bit3=1输出
L 127				    ;bit2int_m    define  0,p1m    ;P1.0  ,bit0=1带上拉的输出
L 128				    ;bit2out_m    define  1,p1m    ;P1.0  ,bit1=1输出
L 129				
L 130				 
L 131				  ;=============================================================
L 132				  ;------------------常量定义-------------
L 133				   num_wtd         equ    #%10100000      ;关闭看门狗
L 134				   ;陶炉档位对应60份功率数据
L 135				   taowat_num1     equ    #10             ;1/7=10
L 136				   taowat_num2     equ    #17             ;2/7=17
L 137				   taowat_num3     equ    #26             ;3/7=26
L 138				   taowat_num4     equ    #34             ;4/7=34
L 139				   taowat_num5     equ    #43             ;5/7=43
L 140				   taowat_num6     equ    #51             ;6/7=51
L 141				   taowat_num7     equ    #60             ;60份满
L 142				
L 143				
L 144				
L 145				;8段码:
L 146				   sm_num0    equ         #%00111111             ;=0
L 147				   sm_num1    equ         #%00000110 
L 148				   sm_num2    equ         #%01011011 
L 149				   sm_num3    equ         #%01001111 
L 150				   sm_num4    equ         #%01100110 
L 151				   sm_num5    equ         #%01101101 
L 152				   sm_num6    equ         #%01111101 
L 153				   sm_num7    equ         #%00000111 
L 154				   sm_num8    equ         #%01111111 
L 155				   sm_num9    equ         #%01101111 
L 156				   sm_numa    equ         #%01110111 
L 157				   sm_numb    equ         #%01111100 
L 158				   sm_numc    equ         #%00111001 
L 159				   sm_numd    equ         #%01011110 
L 160				   sm_nume    equ         #%01111001 
L 161				   sm_numf    equ         #%01110001 
L 162				
L 163				
L 164				  ;=============================================================
L 165				  ;------------------------------------------------------------- 
L 166				  ;用户ram定义;$0030-$00FF 
L 167				  org     $30
L 168				
L 169				  acc_back          ds    1
L 170				  status_back       ds    1
L 171				  ;-------------------------------------------------------------
L 172				  ;时间:
L 173				 
L 174				  yk_125us          ds    1
L 175				  t_125us           ds    1             ;125us 
L 176				  led_125us         ds    1             ;
L 177				  t_1ms             ds    1             ;1ms计时器
L 178				
L 179				  t_250ms           ds    1            ;250ms
L 180				  t_1s              ds    1            ;1秒钟               
L 181				 
L 182				
L 183				 ; mh_1ms            ds    1 
L 184				 ; mh_250ms          ds    1 
L 185				 ; mh_500ms          ds    1
L 186				  ;-------------------------------------------------------------
L 187				
L 188				  
L 189				  f_a               ds    1
L 190				  buzz_on      define     0,f_a   
L 191				  buzlong      define     1,f_a          ;  
L 192				  key_lock     define     3,f_a 
L 193				  power_on     define     4,f_a 
L 194				  yk_ok        define     5,f_a 
L 195				   
L 196				
L 197				
L 198				  f_b              ds     1
L 199				  yk_wate      define     1,f_b          ;循环等标志
L 200				  gl_err       define     2,f_b          ;循环等标志  
L 201				
L 202				                 
L 203				
L 204				  ;----------------------------------------------------------------------
L 205				  num_buzz        ds      1              ;风鸣器响的声数
L 206				  num_watt        ds      1
L 207				  ;-----------------------------------------------------------
L 208				  pcs_ykup        ds      1
L 209				  pcs_ykup125us   ds      1
L 210				
L 211				  pcs_buzz        ds      1               ;风鸣器计时缓存器=5ms*pcs_buzz
L 212				  pcs_com1        ds      1
L 213				 
L 214				
L 215				  pcs_gl_low      ds      1
L 216				  pcs_gler        ds      1
L 217				  pcs_gl_hig      ds      1
L 218				  pcs_watt125us   ds      1
L 219				
L 220				  ;-------------------------------------------------------------
L 221				  buf_qian        ds      1
L 222				  buf_hou         ds      1
L 223				  buf_zuo         ds      1
L 224				  buf_you         ds      1
L 225				  buf_nj          ds      1
L 226				  buf_tao         ds      1
L 227				 
L 228				
L 229				
L 230				  buf_outtime     ds      1
L 231				  buf_outqian     ds      1
L 232				  buf_outhou      ds      1
L 233				  buf_outzuo      ds      1
L 234				  buf_outyou      ds      1
L 235				  ;---------------------------------------------------------------         
L 236				  tm1629b_bit     ds      1     
L 237				  ;---------------------------------------------------------------
L 238				  yk_num1         ds      1               
L 239				  yk_num2         ds      1   
L 240				  yk_num3         ds      1     
L 241				 ;================================================================
L 242				
L 243				    org       $BF
L 244				  buf_sp        ds     1    
L 245				
L 246				  ;====================================================================
L 247				  ;====================================================================
L 248				  ;$1000-$1ff3 存放rom指令, $1ff4---$1ffd 各中断入口;$1ffE--$1FFF 复位入口
L 249				    ORG      $1000
L 250		1000	1002	    fdb      star   
L 251				
L 252				
L 253				
L 254				;*******程序开始*************
L 255				;*********start***************
L 256				star:
L 257	[2]	1002	9B	    sei                          ;关闭中断
L 258	[2]	1003	9C	    rsp                          ;堆栈复位
L 259	[2]	1004	A6A0	    lda      num_wtd             ;=btcon  ,关闭看门狗
L 260	[4]	1006	B70C	    sta      wtdm                ;看门狗控制寄存器
L 261				   ;clr      wtdc                ;看门狗计数器清零
L 262				
L 263				;--------------------------------------------  
L 264				  ;ram清零
L 265				clrram:
L 266	[2]	1008	AEC0	    ldx      #192;208
L 267				ram_clear1:
L 268	[6]	100A	6F2F	    clr      $2F,x
L 269	[3]	100C	5A	    decx
L 270	[3]	100D	2703	    beq      opp2   
L 271	[3]	100F	CC100A	    jmp      ram_clear1
L 272				    
L 273				opp2:
L 274	[2]	1012	9C	    rsp                          ;堆栈复位
L 275	[6]	1013	CD11BF	    jsr      ioset        
L 276	[6]	1016	CD11E2	    jsr      time_stp 
L 277				;-------------------------------------------- 
L 278	[5]	1019	103A	    bset     0,num_buzz
L 279	[5]	101B	1E37	    bset     7,t_1s              ;关继电器
L 280				
L 281				
L 282	[2]	101D	A603	    lda      #03
L 283	[4]	101F	B744	    sta      buf_qian
L 284	[4]	1021	B745	    sta      buf_hou
L 285	[4]	1023	B747	    sta      buf_you             ;???????????????
L 286	[4]	1025	B746	    sta      buf_zuo
L 287	[4]	1027	B748	    sta      buf_nj
L 288	[4]	1029	B749	    sta      buf_tao
L 289	[5]	102B	1838	    bset     power_on
L 290				  ;========================================================================================
L 291				  ;========================================================================================
L 292				  ;主程序循环区:
L 293				main:
L 294	[2]	102D	9D	  nop;jsr           yk_main           ;保护电路数据接收
L 295	[3]	102E	B634	     lda           led_125us
L 296	[2]	1030	A140	     cmp           #64
L 297	[3]	1032	2403	     bhs           main00          
L 298	[3]	1034	CC102D	     jmp           main             ;8MS 
L 299				main00:
L 300	[5]	1037	3F34	     clr           led_125us
L 301	[5]	1039	3C3C	     inc           pcs_ykup
L 302				
L 303	[6]	103B	CD1159	     jsr           buzz_main         ;风鸣器  
L 304	[6]	103E	CD11B0	     jsr           time_main         ;时序程序, 
L 305	[6]	1041	CD1047	     jsr           outcfm_main       ;hort控制 
L 306	[3]	1044	CC102D	     jmp           main 
L 307				  ;========================================================================================
L 308				  ;======================================================================================== 
L 309				
L 310				
L 311				
L 312				
L 313				  ;===========================================================
L 314				  ;===========================================================
L 315				  ;输出控制
L 316				  outcfm_main:
L 317	[5]	1047	083803	       brset         power_on,outcfm_main00
L 318	[3]	104A	CC114D	       jmp           out_alloff    ;关    
L 319				  outcfm_main00:
L 320	[6]	104D	CD10E2	       jsr           outk_tao      ;陶炉
L 321	[6]	1050	CD1078	       jsr           outk_qian     ;前
L 322	[6]	1053	CD1082	       jsr           outk_hou      ;后
L 323	[6]	1056	CD108C	       jsr           outk_zuo      ;左
L 324	[6]	1059	CD1096	       jsr           outk_you      ;右
L 325	[6]	105C	CD106B	       jsr           outk_nj       ;暖脚
L 326				      ;jmp           outk_raly     ;继电器
L 327				  ;------------------------------------------------------------
L 328				  ;继电器:
L 329				  outk_raly:
L 330	[5]	105F	1311	       bclr          raly
L 331	[3]	1061	B637	       lda           t_1s
L 332	[2]	1063	A105	       cmp           #05
L 333	[3]	1065	2402	       bhs           outk_raly00  
L 334	[5]	1067	1211	       bset          raly
L 335				  outk_raly00:
L 336	[2]	1069	9D	       nop
L 337	[6]	106A	81	       rts
L 338				  ;------------------------------------------------------------
L 339				  ;暖脚
L 340				  outk_nj:
L 341	[4]	106B	3D48	        tst          buf_nj
L 342	[3]	106D	2603	        bne          outk_nj00
L 343	[3]	106F	CC1075	        jmp          outnj_off      
L 344				  outk_nj00:
L 345				        ;jmp         outnj_on
L 346				  outnj_on:
L 347	[5]	1072	1312	        bclr         nj_p
L 348	[6]	1074	81	        rts
L 349				  outnj_off:
L 350	[5]	1075	1212	        bset         nj_p
L 351	[6]	1077	81	        rts
L 352				  ;------------------------------------------------------------
L 353				 
L 354				
L 355				  ;-------------------------------------------------
L 356				  ;前
L 357				  outk_qian:
L 358	[3]	1078	B644	        lda          buf_qian
L 359	[4]	107A	B73F	        sta          pcs_com1
L 360	[6]	107C	CD10A0	        jsr          qhzy_wattcunt            ;
L 361	[4]	107F	B74B	        sta          buf_outqian      
L 362	[6]	1081	81	        rts
L 363				  ;后
L 364				  outk_hou:
L 365	[3]	1082	B645	        lda          buf_hou
L 366	[4]	1084	B73F	        sta          pcs_com1
L 367	[6]	1086	CD10A0	        jsr          qhzy_wattcunt            ;
L 368	[4]	1089	B74C	        sta          buf_outhou     
L 369	[6]	108B	81	        rts
L 370				  ;左
L 371				  outk_zuo:
L 372	[3]	108C	B646	        lda          buf_zuo
L 373	[4]	108E	B73F	        sta          pcs_com1
L 374	[6]	1090	CD10A0	        jsr          qhzy_wattcunt            ;
L 375	[4]	1093	B74D	        sta          buf_outzuo     
L 376	[6]	1095	81	        rts
L 377				  ;右
L 378				  outk_you:
L 379	[3]	1096	B647	        lda          buf_you
L 380	[4]	1098	B73F	        sta          pcs_com1
L 381	[6]	109A	CD10A0	        jsr          qhzy_wattcunt            ;
L 382	[4]	109D	B74E	        sta          buf_outyou     
L 383	[6]	109F	81	        rts
L 384				
L 385				  ;前后左右共用:
L 386				  qhzy_wattcunt:
L 387	[4]	10A0	3D3F	        tst          pcs_com1
L 388	[3]	10A2	2603	        bne          watt_qhzyp1
L 389	[3]	10A4	CC10C3	        jmp          qhzy_d0                  ;0档
L 390				  watt_qhzyp1:
L 391	[3]	10A7	B63F	        lda          pcs_com1
L 392	[2]	10A9	A101	        cmp          #01
L 393	[3]	10AB	2603	        bne          watt_qhzyp2
L 394	[3]	10AD	CC10C8	        jmp          qhzy_d1                  ;1档
L 395				  watt_qhzyp2:
L 396	[3]	10B0	B63F	        lda          pcs_com1
L 397	[2]	10B2	A102	        cmp          #02
L 398	[3]	10B4	2603	        bne          watt_qhzyp3
L 399	[3]	10B6	CC10CD	        jmp          qhzy_d2                  ;2档
L 400				  watt_qhzyp3:
L 401	[2]	10B9	A103	        cmp          #03
L 402	[3]	10BB	2603	        bne          watt_qhzyp4
L 403	[3]	10BD	CC10D2	        jmp          qhzy_d3                  ;2档
L 404				  watt_qhzyp4:
L 405	[3]	10C0	CC10D7	        jmp          qhzy_d4                  ;3档
L 406				
L 407				  qhzy_d0:
L 408	[2]	10C3	A600	        lda          #00                      ;
L 409	[3]	10C5	CC10D9	        jmp          qhzy_dsetok
L 410				  qhzy_d1:
L 411	[2]	10C8	A604	        lda          #04                      ;700W之40W  1/20=3.5
L 412	[3]	10CA	CC10D9	        jmp          qhzy_dsetok
L 413				  qhzy_d2:
L 414	[2]	10CD	A614	        lda          #20                      ;700W之200W 1/3=20
L 415	[3]	10CF	CC10D9	        jmp          qhzy_dsetok
L 416				  qhzy_d3:
L 417	[2]	10D2	A628	        lda          #40                      ;700W之450W 2/3=40
L 418	[3]	10D4	CC10D9	        jmp          qhzy_dsetok
L 419				  qhzy_d4:
L 420	[2]	10D7	A63C	        lda          #60                      ;60份满
L 421				       ;jmp          qhzy_dsetok
L 422				  qhzy_dsetok:
L 423	[4]	10D9	B73F	        sta          pcs_com1    
L 424				  ;查表得宽度:
L 425	[3]	10DB	BE3F	        ldx          pcs_com1
L 426	[5]	10DD	D613CD	        lda          table_watt,x
L 427	[2]	10E0	9D	        nop  
L 428	[6]	10E1	81	        rts
L 429				  ;-------------------------------------------------
L 430				  ;陶炉
L 431				  outk_tao:
L 432	[3]	10E2	B649	        lda          buf_tao
L 433	[2]	10E4	A102	        cmp          #02
L 434	[3]	10E6	2403	        bhs          watt_taop1
L 435	[3]	10E8	CC111D	        jmp          tao_d0                   ;0,1档
L 436				  watt_taop1:
L 437	[6]	10EB	CD11A9	        jsr          time_xt_clr              ;继电器延时5S
L 438	[3]	10EE	B649	        lda          buf_tao
L 439	[2]	10F0	A102	        cmp          #02
L 440	[3]	10F2	2603	        bne          watt_taop2
L 441	[3]	10F4	CC1122	        jmp          tao_d1                   ;2档
L 442				  watt_taop2:
L 443	[2]	10F7	A103	        cmp          #03
L 444	[3]	10F9	2603	        bne          watt_taop3
L 445	[3]	10FB	CC1127	        jmp          tao_d2                   ;3档
L 446				  watt_taop3:
L 447	[2]	10FE	A104	        cmp          #04
L 448	[3]	1100	2603	        bne          watt_taop4
L 449	[3]	1102	CC112C	        jmp          tao_d3                   ;4档
L 450				  watt_taop4:
L 451	[2]	1105	A105	        cmp          #05
L 452	[3]	1107	2603	        bne          watt_taop5
L 453	[3]	1109	CC1131	        jmp          tao_d4                   ;5档
L 454				  watt_taop5:
L 455	[2]	110C	A106	        cmp          #06
L 456	[3]	110E	2603	        bne          watt_taop6
L 457	[3]	1110	CC1136	        jmp          tao_d5                   ;6档
L 458				   watt_taop6:
L 459	[2]	1113	A107	        cmp          #07
L 460	[3]	1115	2603	        bne          watt_taop7
L 461	[3]	1117	CC113B	        jmp          tao_d6                   ;7档
L 462				  watt_taop7:
L 463	[3]	111A	CC1140	        jmp          tao_d7                   ;8档
L 464				
L 465				  tao_d0:
L 466	[2]	111D	A600	        lda          #00                      ;
L 467	[3]	111F	CC1142	        jmp          tao_dsetok
L 468				  tao_d1:
L 469	[2]	1122	A60A	        lda          taowat_num1              ;1/7=10
L 470	[3]	1124	CC1142	        jmp          tao_dsetok
L 471				  tao_d2:
L 472	[2]	1127	A611	        lda          taowat_num2              ;2/7=17
L 473	[3]	1129	CC1142	        jmp          tao_dsetok
L 474				  tao_d3:
L 475	[2]	112C	A61A	        lda          taowat_num3              ;3/7=26
L 476	[3]	112E	CC1142	        jmp          tao_dsetok
L 477				  tao_d4:
L 478	[2]	1131	A622	        lda          taowat_num4              ;4/7=34
L 479	[3]	1133	CC1142	        jmp          tao_dsetok
L 480				  tao_d5:
L 481	[2]	1136	A62B	        lda          taowat_num5              ;5/7=43
L 482	[3]	1138	CC1142	        jmp          tao_dsetok
L 483				  tao_d6:
L 484	[2]	113B	A633	        lda          taowat_num6              ;6/7=51
L 485	[3]	113D	CC1142	        jmp          tao_dsetok
L 486				  tao_d7:
L 487	[2]	1140	A63C	        lda          taowat_num7              ;60份满
L 488				       ;jmp          tao_dsetok
L 489				  tao_dsetok:
L 490	[4]	1142	B73F	        sta          pcs_com1    
L 491				  ;查表得宽度:
L 492	[3]	1144	BE3F	        ldx          pcs_com1
L 493	[5]	1146	D613CD	        lda          table_watt,x
L 494	[4]	1149	B74A	        sta          buf_outtime 
L 495	[2]	114B	9D	        nop     
L 496	[6]	114C	81	        rts
L 497				  ;----------------------------------------------------------
L 498				  out_alloff:
L 499	[5]	114D	3F4A	        clr          buf_outtime     ;关陶炉
L 500	[5]	114F	3F4B	        clr          buf_outqian
L 501	[5]	1151	3F4C	        clr          buf_outhou
L 502	[5]	1153	3F4D	        clr          buf_outzuo
L 503	[5]	1155	3F4E	        clr          buf_outyou
L 504	[2]	1157	9D	        nop
L 505	[6]	1158	81	        rts
L 506				  ;===========================================================
L 507				  ;===========================================================
L 508				
L 509				
L 510				
L 511				
L 512				
L 513				
L 514				
L 515				  ;============================================================
L 516				  ;============================================================
L 517				  ;******************** 4  风鸣器 8ms进1次  *******************
L 518				buzz_main:
L 519	[3]	1159	B63A	     lda         num_buzz
L 520	[3]	115B	2603	     bne         buzz_main00        
L 521	[3]	115D	CC119C	     jmp         buzz_off            ;无须发声 
L 522				buzz_main00:     
L 523				     ;bset        buz_c
L 524	[5]	1160	3C3E	     inc         pcs_buzz            ;16ms*pcs_buzz
L 525	[3]	1162	B63E	     lda         pcs_buzz
L 526	[2]	1164	A11E	     cmp         #30
L 527	[3]	1166	2503	     blo         bu_mainon0a         
L 528	[3]	1168	CC117D	     jmp         buzz_low            ;大于等于跳转
L 529				 bu_mainon0a:
L 530	[5]	116B	033803	     brclr       buzlong,bu_mainon0b
L 531	[3]	116E	CC117A	     jmp         buzhig_h00          ;长响(0.5)标志
L 532				  bu_mainon0b:
L 533	[3]	1171	B63E	     lda         pcs_buzz
L 534	[2]	1173	A10A	     cmp         #10
L 535	[3]	1175	2503	     blo         buzhig_h00        
L 536	[3]	1177	CC117D	     jmp         buzz_low
L 537				buzhig_h00:
L 538	[5]	117A	1038	     bset        buzz_on              ;0.25S内响
L 539	[6]	117C	81	     rts                              ;0.25S--0.5S
L 540				   
L 541				buzz_low:
L 542	[5]	117D	1138	     bclr        buzz_on
L 543	[3]	117F	B63E	     lda         pcs_buzz
L 544	[2]	1181	A182	     cmp         #130;30+100
L 545	[3]	1183	2503	     blo         buzlow0a   
L 546	[3]	1185	CC1193	     jmp         buzz_low0
L 547				  buzlow0a:
L 548	[5]	1188	033801	     brclr       buzlong,buzlow0b
L 549	[6]	118B	81	     rts                           ;长响(0.5)标志
L 550				  buzlow0b:
L 551	[3]	118C	B63E	     lda         pcs_buzz
L 552	[2]	118E	A114	     cmp         #20;10+10
L 553	[3]	1190	2401	     bhs         buzz_low0        
L 554	[6]	1192	81	     rts
L 555				
L 556				buzz_low0:
L 557	[5]	1193	3F3E	     clr         pcs_buzz        ;0.5S算响1声
L 558	[5]	1195	3A3A	     dec         num_buzz
L 559	[3]	1197	2701	     beq         buzz_out        
L 560	[6]	1199	81	     rts
L 561				        
L 562				buzz_out:
L 563	[5]	119A	1338	     bclr        buzlong
L 564				    ;clr         pcs_adint
L 565				buzz_off:
L 566	[5]	119C	1138	     bclr        buzz_on
L 567				    ;bclr        buz_c           ; 
L 568				buzmain_out:     
L 569	[6]	119E	81	     rts
L 570				     
L 571				  ;==========================================================
L 572				  ;==========================================================
L 573				
L 574				
L 575				
L 576				
L 577				
L 578				
L 579				
L 580				    
L 581				  
L 582				
L 583				     
L 584				  ;==========================================================
L 585				  ;========================================================== 
L 586				despaly_main:
L 587	[4]	119F	B73F	     sta        pcs_com1
L 588				despaly_main00:                  ;3us*pcs_com1
L 589	[5]	11A1	3A3F	     dec        pcs_com1 
L 590	[3]	11A3	2703	     beq        despaly_mainout         
L 591	[3]	11A5	CC11A1	     jmp        despaly_main00
L 592				despaly_mainout:
L 593	[6]	11A8	81	     rts
L 594				  ;==========================================================
L 595				  ;==========================================================
L 596				
L 597				
L 598				
L 599				
L 600				
L 601				
L 602				
L 603				  ;========================================================
L 604				  ;======================================================== 
L 605				  ;------ 时间校0 -------------
L 606				time_clr:    
L 607				     ;jsr        time_mh_clr
L 608				time_xt_clr:
L 609	[5]	11A9	3F35	     CLR        t_1ms
L 610	[5]	11AB	3F36	     clr        t_250ms
L 611	[5]	11AD	3F37	     clr        t_1s
L 612	[6]	11AF	81	     rts
L 613				;time_mh_clr:
L 614				     ;clr        mh_1ms
L 615				     ;clr        mh_250ms
L 616				     ;clr        mh_500ms
L 617				     ;rts
L 618				  ;========================================================
L 619				  ;========================================================
L 620				
L 621				
L 622				
L 623				
L 624				
L 625				
L 626				
L 627				
L 628				  
L 629				     
L 630				     
L 631				
L 632				  
L 633				
L 634				  ;==========================================================
L 635				  ;==========================================================
L 636				  ;*************         12  时间程序        ****************
L 637				time_main:
L 638				    ;jsr         time_mh_1s
L 639				    ;jmp         time_xt_1s  
L 640				   ;---------------------------------
L 641				
L 642				time_xt_1s:
L 643	[5]	11B0	043601	     brset       2,t_250ms,xt_1sinc   ;250ms*4=1S 
L 644	[6]	11B3	81	     rts
L 645				  xt_1sinc: 
L 646	[5]	11B4	3F36	     clr         t_250ms
L 647	[3]	11B6	B637	     lda         t_1s
L 648	[2]	11B8	A1FF	     cmp         #255
L 649	[3]	11BA	2402	     bhs         xt_1sinc00  
L 650	[5]	11BC	3C37	     inc         t_1s
L 651				  xt_1sinc00:
L 652	[6]	11BE	81	     rts  
L 653				 
L 654				  
L 655				
L 656				;time_mh_1s:
L 657				      ;brset      1,mh_250ms,mh_500msinc
L 658				      ;rts
L 659				 ;mh_500msinc:
L 660				      ;clr        mh_250ms
L 661				      ;inc        mh_500ms
L 662				      ;lda        mh_500ms
L 663				      ;cmp        #15                       ;14+1;SET=50W*14=700W
L 664				      ;blo        mh_500msinc01
L 665				      ;clr        mh_500ms
L 666				  ;mh_500msinc01:   
L 667				      ;rts       
L 668				  ;=========================================================
L 669				  ;=========================================================
L 670				 
L 671				 
L 672				
L 673				
L 674				  ;=========================================
L 675				  ;=========================================
L 676				  ;口线设置
L 677				ioset:
L 678				  ; 设置各I/O口状态设置:
L 679	[2]	11BF	A624	    lda      #%00100100         ;
L 680	[4]	11C1	B716	    sta      p0mh;P0CONH
L 681				   ;lda      #%11101010         ; 
L 682				   ;sta      p0mL;P0CONL 
L 683	[5]	11C3	3F17	    clr      p0mL;P0CONL        ;不带上拉的输入
L 684	[5]	11C5	3F18	    clr      p0int              ;=p0pnd
L 685	[2]	11C7	A609	    lda      #%00001001         ;P1.0过零,带上拉的输入
L 686	[4]	11C9	B719	    sta      p1m
L 687	[2]	11CB	A64A	    lda      #%01001010         ; 
L 688	[4]	11CD	B71A	    sta      p2mh;P2CONH
L 689	[2]	11CF	A6A9	    lda      #%10101001
L 690	[4]	11D1	B71B	    sta      p2mL;P2CONL
L 691				 ;设置各I/O口初始电压
L 692				  out_off:
L 693	[5]	11D3	1311	    bclr     raly
L 694	[5]	11D5	1412	    bset     tao_p
L 695	[5]	11D7	1C12	    bset     qian_p
L 696	[5]	11D9	1A12	    bset     hou_p
L 697	[5]	11DB	1812	    bset     zuo_p
L 698	[5]	11DD	1612	    bset     you_p
L 699	[5]	11DF	1212	    bset     nj_p
L 700	[6]	11E1	81	    rts
L 701				  ;-----------------------------------------------------------
L 702				  ;定时器设置:
L 703				time_stp:
L 704	[5]	11E2	3F23	    clr      pwmm  
L 705	[2]	11E4	A63E	    lda      #62         ;2us*62=125us
L 706	[4]	11E6	B701	    sta      t0data       ;比较值 
L 707	[2]	11E8	A688	    lda      #%10001000
L 708	[4]	11EA	B702	    sta      t0m
L 709				
L 710				   ;t0m=t0con    t0控制器
L 711				   ;分频 bit7   bit6    ,以系统时钟分
L 712				   ;      0       0     ,fcpu/4096
L 713				   ;      0       1     ,fcpu/256
L 714				   ;      1       0     ,fcpu/8
L 715				   ;      1       1     ,fcpu/1
L 716				   ;bit5  bit4   空
L 717				   ;t0m,3: t0clr          ;=1清t0c(t0cnt)
L 718				   ;bit2         空 
L 719				   ;t0m,1: t0ie    ;=1,t0中断开
L 720				   ;t0m,0: t0f     ;t0中断标志位
L 721				
L 722	[2]	11EC	9A	    cli
L 723	[5]	11ED	1202	    bset     t0ie
L 724	[6]	11EF	81	    rts
L 725				  ;--------------------------------------------
L 726				  ;定时中断
L 727				int_time:
L 728	[5]	11F0	000203	    brset    t0f,int_ok 
L 729	[3]	11F3	CC12FA	    jmp      int_timeout
L 730				int_ok:    
L 731	[5]	11F6	1102	    bclr     t0f;0,T0CON
L 732	[5]	11F8	3C34	    inc      led_125us 
L 733	[5]	11FA	3C33	    inc      t_125us
L 734	[5]	11FC	3C3D	    inc      pcs_ykup125us
L 735				
L 736	[3]	11FE	B632	    lda      yk_125us
L 737	[2]	1200	A1FF	    cmp      #255
L 738	[3]	1202	2402	    bhs      int_buzzmain
L 739	[5]	1204	3C32	    inc      yk_125us
L 740				int_buzzmain:
L 741	[5]	1206	003803	    brset    buzz_on,int_buz00
L 742	[3]	1209	CC1217	    jmp      buz_low 
L 743				int_buz00:    
L 744	[5]	120C	023303	    brset    1,t_125us,int_buzz01
L 745	[3]	120F	CC1217	    jmp      buz_low    ; .0
L 746				int_buzz01:
L 747	[5]	1212	1C10	    bset     buzz;temp_buzz            ;256--500us开,0--255us关 
L 748	[3]	1214	CC1219	    jmp      int_time1
L 749				buz_low:
L 750	[5]	1217	1D10	    bclr     buzz;temp_buzz
L 751				
L 752				int_time1:
L 753	[5]	1219	063303	    brset    3,t_125us,int_time10         ;125us*8=1mS  
L 754	[3]	121C	CC1230	    jmp      int_cut;int_timeout
L 755				int_time10:    
L 756	[5]	121F	3F33	    clr      t_125us 
L 757	[5]	1221	3C35	    inc      t_1ms
L 758				  
L 759	[3]	1223	B635	    lda      t_1ms
L 760	[2]	1225	A1FA	    cmp      #250
L 761	[3]	1227	2403	    bhs      int_xt250ms      
L 762	[3]	1229	CC1230	    jmp      int_cut                     ;不够250ms
L 763				int_xt250ms:
L 764	[5]	122C	3F35	    clr      t_1ms
L 765	[5]	122E	3C36	    inc      t_250ms  
L 766				 ;-----------------------------------------------------------
L 767				 ;过零检测:
L 768				  int_cut:
L 769	[5]	1230	011103	      brclr        guoling,gl_lowmain
L 770	[3]	1233	CC1270	      jmp          gl_higmain         ;过零高
L 771				  ;过零低
L 772				  gl_lowmain:
L 773	[3]	1236	B640	      lda          pcs_gl_low 
L 774	[2]	1238	A1FF	      cmp          #255
L 775	[3]	123A	2503	      blo          gl_l00
L 776	[3]	123C	CC1261	      jmp          intgl_err
L 777				  gl_l00:
L 778	[5]	123F	3C40	      inc          pcs_gl_low 
L 779	[3]	1241	B640	      lda          pcs_gl_low
L 780	[2]	1243	A102	      cmp          #02
L 781	[3]	1245	2703	      beq          gl_l01
L 782	[3]	1247	CC124E	      jmp          gl_l02
L 783				  gl_l01:
L 784	[5]	124A	1539	      bclr         gl_err             ;过零出错
L 785	[5]	124C	3F41	      clr          pcs_gler
L 786				  gl_l02:
L 787	[3]	124E	2403	      bhs          gl_l03
L 788	[3]	1250	CC129C	      jmp          int_gui
L 789				  gl_l03:
L 790	[5]	1253	3F42	      clr          pcs_gl_hig 
L 791	[4]	1255	3D43	      tst          pcs_watt125us
L 792	[3]	1257	2603	      bne          gl_l04
L 793	[3]	1259	CC129C	      jmp          int_gui
L 794				  gl_l04:
L 795	[5]	125C	3A43	      dec          pcs_watt125us
L 796	[3]	125E	CC129C	      jmp          int_gui
L 797				
L 798				
L 799				  intgl_err:
L 800	[5]	1261	3C41	      inc          pcs_gler
L 801	[5]	1263	064103	      brset        3,pcs_gler,gl_err00
L 802	[3]	1266	CC129C	      jmp          int_gui
L 803				  gl_err00:
L 804	[5]	1269	1439	      bset         gl_err             ;过零出错
L 805	[5]	126B	3F41	      clr          pcs_gler
L 806	[3]	126D	CC129C	      jmp          int_gui
L 807				
L 808				  gl_higmain:     ;过零高: 
L 809	[3]	1270	B642	      lda          pcs_gl_hig
L 810	[2]	1272	A1FF	      cmp          #255
L 811	[3]	1274	2503	      blo          gl_h00
L 812	[3]	1276	CC1261	      jmp          intgl_err
L 813				  gl_h00:
L 814	[5]	1279	3C42	      inc          pcs_gl_hig
L 815	[3]	127B	B642	      lda          pcs_gl_hig
L 816	[2]	127D	A102	      cmp          #02
L 817	[3]	127F	2703	      beq          gl_h01
L 818	[3]	1281	CC1288	      jmp          gl_h02
L 819				  gl_h01:
L 820	[5]	1284	1539	      bclr         gl_err             ;过零出错
L 821	[5]	1286	3F41	      clr          pcs_gler         
L 822				  gl_h02:
L 823	[3]	1288	2403	      bhs          gl_h03
L 824	[3]	128A	CC129C	      jmp          int_gui
L 825				  gl_h03:
L 826	[3]	128D	B640	      lda          pcs_gl_low
L 827	[2]	128F	A137	      cmp          #55
L 828	[3]	1291	2403	      bhs          gl_h04
L 829	[3]	1293	CC129C	      jmp          int_gui            ;SET
L 830				  gl_h04:
L 831	[5]	1296	3F40	      clr          pcs_gl_low
L 832	[2]	1298	A650	      lda          #80
L 833	[4]	129A	B743	      sta          pcs_watt125us         
L 834				  ;输出---------------------------------------------------------------
L 835				  int_gui:
L 836	[5]	129C	053903	      brclr        gl_err,int_guiqian    ;过零出错
L 837	[3]	129F	CC12F0	      jmp          int_alloff          ;不开通 
L 838				 ;前:
L 839				  int_guiqian:
L 840	[3]	12A2	B643	      lda          pcs_watt125us
L 841	[3]	12A4	B14B	      cmp          buf_outqian
L 842	[3]	12A6	2403	      bhs          int_guiqian00
L 843	[3]	12A8	CC12B0	      jmp          int_guiqian01
L 844				  int_guiqian00:
L 845	[5]	12AB	1C12	      bset         qian_p
L 846	[3]	12AD	CC12B2	      jmp          int_guihou          ;
L 847				  int_guiqian01:                       ;设定输出宽度                 
L 848	[5]	12B0	1D12	      bclr         qian_p              ;实际宽度低于设定宽度,开通
L 849				 ;后:
L 850				  int_guihou:
L 851	[3]	12B2	B643	      lda          pcs_watt125us
L 852	[3]	12B4	B14C	      cmp          buf_outhou
L 853	[3]	12B6	2403	      bhs          int_guihou00
L 854	[3]	12B8	CC12C0	      jmp          int_guihou01
L 855				  int_guihou00:
L 856	[5]	12BB	1A12	      bset         hou_p
L 857	[3]	12BD	CC12C2	      jmp          int_guizuo          ;
L 858				  int_guihou01:                       ;设定输出宽度                 
L 859	[5]	12C0	1B12	      bclr         hou_p              ;实际宽度低于设定宽度,开通 
L 860				 ;左:
L 861				  int_guizuo:
L 862	[3]	12C2	B643	      lda          pcs_watt125us
L 863	[3]	12C4	B14D	      cmp          buf_outzuo
L 864	[3]	12C6	2403	      bhs          int_guizuo00
L 865	[3]	12C8	CC12D0	      jmp          int_guizuo01
L 866				  int_guizuo00:
L 867	[5]	12CB	1812	      bset         zuo_p
L 868	[3]	12CD	CC12D2	      jmp          int_guiyou          ;
L 869				  int_guizuo01:                       ;设定输出宽度                 
L 870	[5]	12D0	1912	      bclr         zuo_p              ;实际宽度低于设定宽度,开通 
L 871				 ;右:
L 872				  int_guiyou:
L 873	[3]	12D2	B643	      lda          pcs_watt125us
L 874	[3]	12D4	B14E	      cmp          buf_outyou
L 875	[3]	12D6	2403	      bhs          int_guiyou00
L 876	[3]	12D8	CC12E0	      jmp          int_guiyou01
L 877				  int_guiyou00:
L 878	[5]	12DB	1612	      bset         you_p
L 879	[3]	12DD	CC12E2	      jmp          int_guitao          ;
L 880				  int_guiyou01:                       ;设定输出宽度                 
L 881	[5]	12E0	1712	      bclr         you_p              ;实际宽度低于设定宽度,开通 
L 882				
L 883				 ;陶炉:
L 884				  int_guitao:
L 885	[3]	12E2	B643	      lda          pcs_watt125us
L 886	[3]	12E4	B14A	      cmp          buf_outtime
L 887	[3]	12E6	2503	      blo          int_guitao01
L 888	[3]	12E8	CC12F8	      jmp          int_mortstop       ;电机当前脉宽(递减方式)
L 889				  int_guitao01:                                                           ;设定输出宽度                 
L 890	[5]	12EB	1512	      bclr         tao_p              ;实际宽度低于设定宽度,开通
L 891	[3]	12ED	CC12FA	      jmp          int_timeout
L 892				  ;--------------------------------------------
L 893				  int_alloff:
L 894	[5]	12F0	1C12	      bset         qian_p
L 895	[5]	12F2	1A12	      bset         hou_p
L 896	[5]	12F4	1812	      bset         zuo_p
L 897	[5]	12F6	1612	      bset         you_p
L 898				  int_mortstop:
L 899	[5]	12F8	1412	      bset         tao_p              ;关闭
L 900				  int_timeout:
L 901	[9]	12FA	80	    rti  
L 902				  ;===========================================  
L 903				  ;===========================================  
L 904				
L 905				
L 906				
L 907				  
L 908				 
L 909				
L 910				  ;==========================================================
L 911				  ;==========================================================  
L 912				  ;      -----------------                    ----------
L 913				  ;     ↑               ↓       ↑---------↑         ↑下1bit
L 914				  ;-----                  -------- 
L 915				  ;       25ms头码        312us    高1低0
L 916				  yk_main:
L 917	[5]	12FB	0A1003	      brset         yk_int,yk_higmain
L 918	[3]	12FE	CC13BC	      jmp           yk_upmain
L 919				  yk_higmain:
L 920	[5]	1301	3F3D	      clr           pcs_ykup125us
L 921	[5]	1303	3F3C	      clr           pcs_ykup
L 922	[5]	1305	3F32	      clr           yk_125us
L 923	[5]	1307	083801	      brset         power_on,yk_higmain00
L 924	[6]	130A	81	      rts                                   ;线路故障
L 925				  yk_higmain00:
L 926	[5]	130B	3F34	      clr           led_125us
L 927	[5]	130D	0B3801	      brclr         yk_ok,yk_higmain01
L 928	[6]	1310	81	      rts                                   ;已经接收
L 929				  yk_higmain01:
L 930	[5]	1311	0A1003	      brset         yk_int,yk_higmain02
L 931	[3]	1314	CC1325	      jmp           yk_higp                 ;头码判断
L 932				  yk_higmain02:
L 933	[3]	1317	B632	      lda           yk_125us
L 934	[2]	1319	A1FF	      cmp           #255                    ;30ms
L 935	[3]	131B	2403	      bhs           yk_errmain
L 936	[3]	131D	CC1311	      jmp           yk_higmain01
L 937				  yk_errmain:
L 938	[5]	1320	1938	      bclr          power_on
L 939				  ykint_ret:
L 940	[5]	1322	3F3D	      clr           pcs_ykup125us
L 941	[6]	1324	81	      rts
L 942				
L 943				
L 944				  ;头码判断
L 945				  yk_higp:
L 946	[3]	1325	B632	      lda           yk_125us
L 947	[2]	1327	A118	      cmp           #24                    ;3msyishang
L 948	[3]	1329	2503	      blo           yk_higp00
L 949	[3]	132B	CC132F	      jmp           yk_bufintmain          ;数据接收
L 950				  yk_higp00:
L 951	[6]	132E	81	      rts                                  ;继续等头码
L 952				
L 953				  ;数据接收 :
L 954				  yk_bufintmain:
L 955	[5]	132F	3F32	      clr           yk_125us
L 956	[5]	1331	3F52	      clr           yk_num3
L 957	[5]	1333	3F4F	      clr           tm1629b_bit
L 958				
L 959				  yk_bufintmain00:
L 960				  ;读1bit:   ;210
L 961	[2]	1335	A6D2	      lda           #210            ; 
L 962	[6]	1337	CD119F	      jsr           despaly_main         
L 963				
L 964				  ;位读取:
L 965	[5]	133A	1152	      bclr          0,yk_num3
L 966	[5]	133C	0B1002	      brclr         yk_int,rade_1bitok
L 967	[5]	133F	1052	      bset          0,yk_num3
L 968				  rade_1bitok:  ;170
L 969	[2]	1341	A696	      lda           #150
L 970	[6]	1343	CD119F	      jsr           despaly_main                 
L 971				     
L 972	[5]	1346	3C4F	      inc           tm1629b_bit
L 973	[3]	1348	B64F	      lda           tm1629b_bit
L 974	[2]	134A	A118	      cmp           #24             ;8bit*3=24
L 975	[3]	134C	2503	      blo           bitok_8p
L 976	[3]	134E	CC1387	      jmp           ykbuf_okmain    ;3个数据,24bit
L 977				  bitok_8p:
L 978	[2]	1351	A108	      cmp           #08
L 979	[3]	1353	2603	      bne           bitok_16p         
L 980	[3]	1355	CC1377	      jmp           ykbuf_8bit      ;1个数据,8bit
L 981				  bitok_16p:
L 982	[2]	1358	A110	      cmp           #16
L 983	[3]	135A	2603	      bne           bitint_inc         
L 984	[3]	135C	CC137E	      jmp           ykbuf_16bit     ;2个数据,16bit
L 985				  bitint_inc:
L 986	[5]	135F	3852	      lsl           yk_num3         ;逻辑左移
L 987	[5]	1361	3F32	      clr           yk_125us
L 988				  ;等低电平:
L 989				  bitwat_low:
L 990	[5]	1363	0A1003	      brset         yk_int,bitwat_low00
L 991	[3]	1366	CC1335	      jmp           yk_bufintmain00 ;继续接收
L 992				  bitwat_low00:
L 993	[3]	1369	B632	      lda           yk_125us
L 994	[2]	136B	A110	      cmp           #16             ;2ms
L 995	[3]	136D	2403	      bhs           bitwat_low01
L 996	[3]	136F	CC1363	      jmp           bitwat_low
L 997				  bitwat_low01:
L 998	[5]	1372	3F34	      clr           led_125us
L 999	[3]	1374	CC1322	      jmp           ykint_ret       ;接收出错,等下一个头码
L 1000				
L 1001				  ;成功1个数据,8bit
L 1002				  ykbuf_8bit:
L 1003	[3]	1377	B652	      lda           yk_num3
L 1004	[4]	1379	B750	      sta           yk_num1
L 1005	[3]	137B	CC1382	      jmp           ykbuf_okcl
L 1006				  ;成功2个数据,16bit
L 1007				  ykbuf_16bit:
L 1008	[3]	137E	B652	      lda           yk_num3
L 1009	[4]	1380	B751	      sta           yk_num2
L 1010				  ykbuf_okcl:
L 1011	[5]	1382	3F32	      clr           yk_125us
L 1012	[3]	1384	CC1363	      jmp           bitwat_low
L 1013				
L 1014				  ;数据全部成功,24bit
L 1015				  ykbuf_okmain:
L 1016	[5]	1387	1A38	      bset          yk_ok                ;接收合格  
L 1017	[3]	1389	B650	      lda           yk_num1
L 1018	[2]	138B	A40F	      and           #%00001111
L 1019	[4]	138D	B745	      sta           buf_hou
L 1020				
L 1021	[3]	138F	B651	      lda           yk_num2
L 1022	[2]	1391	A40F	      and           #%00001111
L 1023	[4]	1393	B747	      sta           buf_you
L 1024				
L 1025	[3]	1395	B652	      lda           yk_num3
L 1026	[2]	1397	A40F	      and           #%00001111
L 1027	[4]	1399	B748	      sta           buf_nj
L 1028				
L 1029	[2]	139B	A604	      lda           #04
L 1030				  ykbuf_lsr:                   ;右移
L 1031	[5]	139D	3450	      lsr           yk_num1
L 1032	[5]	139F	3451	      lsr           yk_num2
L 1033	[5]	13A1	3452	      lsr           yk_num3
L 1034	[3]	13A3	4A	      deca
L 1035	[3]	13A4	2703	      beq           ykbuf_lsr00 
L 1036	[3]	13A6	CC139D	      jmp           ykbuf_lsr
L 1037				    ykbuf_lsr00:
L 1038	[3]	13A9	B650	      lda           yk_num1
L 1039	[4]	13AB	B744	      sta           buf_qian
L 1040	[3]	13AD	B651	      lda           yk_num2
L 1041	[4]	13AF	B746	      sta           buf_zuo
L 1042	[3]	13B1	B652	      lda           yk_num3
L 1043	[4]	13B3	B749	      sta           buf_tao
L 1044				
L 1045	[5]	13B5	3F3D	      clr           pcs_ykup125us
L 1046	[5]	13B7	1E34	      bset          7,led_125us
L 1047				
L 1048	[5]	13B9	103A	      bset          0,num_buzz
L 1049				
L 1050	[6]	13BB	81	      rts
L 1051				 
L 1052				
L 1053				
L 1054				yk_upmain:
L 1055	[3]	13BC	B63D	      lda           pcs_ykup125us
L 1056	[2]	13BE	A128	      cmp           #40           ;5ms         
L 1057	[3]	13C0	2502	      blo           yk_upmain00
L 1058	[5]	13C2	1838	      bset          power_on      ;开机
L 1059				yk_upmain00:
L 1060	[3]	13C4	B63C	      lda           pcs_ykup
L 1061	[2]	13C6	A105	      cmp           #5            ;8ms*=600MS,可以再接收
L 1062	[3]	13C8	2502	      blo           yk_upmain01
L 1063	[5]	13CA	1B38	      bclr          yk_ok
L 1064				yk_upmain01:
L 1065	[6]	13CC	81	      rts   
L 1066				  ;==========================================================
L 1067				  ;========================================================== 
L 1068				   
L 1069				
L 1070				
L 1071				
L 1072				
L 1073				
L 1074				
L 1075				
L 1076				
L 1077				
L 1078				
L 1079				
L 1080				
L 1081				  ;===========================================      
L 1082				  ;=========================================== 
L 1083				  table_watt:
L 1084		13CD	00	     fcb    $00     ;0档
L 1085		13CE	1518191B	     fcb    $15,$18,$19,$1B,$1D,$1E,$1F,$20,$21,$23      ;01,02,03,04,05,06,07,08,09,10
			1D1E1F20	
			2123	
L 1086		13D8	24242526	     fcb    36,36,37,38,39,39,40,41,42,42      ;11,12,13,14,15,16,17,18,19,20
			27272829	
			2A2A	
L 1087		13E2	2A2B2C2C	     fcb    42,43,44,44,45,46,46,47,48,48      ;21,22,23,24,25,26,27,28,29,30
			2D2E2E2F	
			3030	
L 1088		13EC	31323333	     fcb    49,50,51,51,52,52,53,54,55,56      ;31,32,33,34,35,36,37,38,39,40
			34343536	
			3738	
L 1089		13F6	38393A3B	     fcb    56,57,58,59,59,60,61,62,63,64      ;41,42,43,44,45,46,47,48,49,50
			3B3C3D3E	
			3F40	
L 1090		1400	41424344	     fcb    65,66,67,68,70,73,74,76,79,85,85   ;51,52,53,54,55,56,57,58,59,60 
			46494A4C	
			4F5555	
L 1091				     
L 1092				     
L 1093				     
L 1094				     
L 1095				     ;十进制
L 1096				     ;fcb    #21,#24,25,27,29,30,31,32,33,35      ;01,02,03,04,05,06,07,08,09,10
L 1097				     ;fcb    36,36,37,38,39,39,40,41,42,42      ;11,12,13,14,15,16,17,18,19,20
L 1098				     ;fcb    42,43,44,44,45,46,46,47,48,48      ;21,22,23,24,25,26,27,28,29,30
L 1099				     ;fcb    49,50,51,51,52,52,53,54,55,56      ;31,32,33,34,35,36,37,38,39,40
L 1100				     ;fcb    56,57,58,59,59,60,61,62,63,64      ;41,42,43,44,45,46,47,48,49,50
L 1101				     ;fcb    65,66,67,68,70,73,74,76,79,85,85   ;51,52,53,54,55,56,57,58,59,60
L 1102				
L 1103				
L 1104				  ;==========================================================
L 1105				  ;==========================================================
L 1106				  
L 1107				
L 1108				
L 1109				
L 1110				  
L 1111				
L 1112				  ;============================================
L 1113				    ORG    $1ff1
L 1114	[3]	1FF1	CC102D	    jmp    main
L 1115				    ;interrupt vector
L 1116				;    ORG    $1ff4
L 1117				;    FDB    int1
L 1118				    ORG    $1ff6
L 1119		1FF6	11F0	    FDB    int_time;t0int
L 1120				;   ORG    $1ff8
L 1121				;   FDB    pwmint
L 1122				;   ORG    $1ffa
L 1123				;   FDB    int0
L 1124				;   ORG    $1ffc
L 1125				;   FDB    swi
L 1126				    ORG    $1ffe
L 1127		1FFE	1002	    FDB    star
L 1128				
L 1129				
L 1130				
