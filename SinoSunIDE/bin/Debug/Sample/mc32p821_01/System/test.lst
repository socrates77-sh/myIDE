gpasm-1.4.0 (Sep 22 2013)    test.asm           2013-11-22  10:34:41         PAGE  1


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00001 
                      00002 
                      00003 #include mc32p821.inc
                      00001 
                      00002 ;==========================================================================
                      00003 ;
                      00004 ;       Revision History
                      00005 ;
                      00006 ;==========================================================================
                      00007 
                      00008 ;Rev:   Date:    Reason:
                      00009 
                      00010 ;1.00   12/06/21 Initial Release
                      00011 
                      00012 ;==========================================================================
                      00013 ;
                      00014 ;       Register Definitions
                      00015 ;
                      00016 ;==========================================================================
                      00017 
                      00018 ;W                            EQU     H'0000'
                      00019 ;F                            EQU     H'0001'
                      00020 
                      00021 ;----- Register Files------------------------------------------------------
                      00022 cblock  0x180
                      00023 INDF0                   
                      00024 INDF1                   
                      00025 INDF2                   
                      00026 HIBYTE                  
                      00027 FSR0                    
                      00028 FSR1                    
                      00029 PCL                     
                      00030 PFALG                   
                      00031 ;----0x188
                      00032 MCR                     
                      00033 INDF3                   
                      00034 INTE                    
                      00035 INTF                    
                      00036 AAAA_R00                
                      00037 INVALID_ADDR1           
                      00038 INVALID_ADDR2           
                      00039 INVALID_ADDR3           
                      00040 ;----0x190
                      00041 IOP0                    
                      00042 OEP0                    
                      00043 PUP0           
                      00044 ANSEL
                      00045 IOP1                      
                      00046 OEP1                    
                      00047 PUP1                    
                      00048 KBIM           
                      00049 ;-----0x198                        
                      00050 INVALID_ADDR5                      
                      00051 INVALID_ADDR6                    
                      00052 INVALID_ADDR7           
                      00053 INVALID_ADDR8           
                      00054 INVALID_ADDR9           
                      00055 INVALID_ADDRA           
                      00056 INVALID_ADDRB           
                      00057 INVALID_ADDRC           
                      00058 ;-----0x1a0
                      00059 T0CR                    
                      00060 T0CNT                   
                      00061 T0LOAD                  
                      00062 T0DATA                  
                      00063 T1CR                    
                      00064 T1CNT                   
                      00065 T1LOAD                  
                      00066 T1DATA                  
                      00067 ;-----0x1a8                        
                      00068 T2CR                     
                      00069 T2CNT                    
                      00070 T2LOAD
                      00071 AA_R4                   
                      00072 PWMCR                  
                      00073 AA_R0                     
                      00074 OSCM                   
                      00075 AA_R2                                       
                      00076 ;-----0x1b0
                      00077 ADCR0                   
                      00078 ADCR1                                     
                      00079 endc
                      00080 
                      00081 
                      00082 ;-----------------------------------
                      00083 
                      00084 
                      00085 ;------------------------------------
                      00086 #define         ADRH            0X1B4
                      00087 #define         ADRL            0X1B5
                      00088 #define         OSCCAL  0X1FB
                      00089 
                      00090 ;#define                sleep                   stop
                      00091 #define         STATUS          PFALG
                      00092 #define         INDF            INDF0
                      00093 
                      00094 #define         INTECON         INTE    
                      00095 
                      00096 
                      00097 ;----- STATUS Bits --------------------------
                      00098 #define Z       STATUS,2
                      00099 #define DC      STATUS,1
                      00100 #define C       STATUS,0
                      00101 
                      00102 ;----- MCR Bits --------------------------
                      00103 #define GIE     MCR,7
                      00104 
                      00105 
                      00106 ;----- INTECON Bits --------------------------
                      00107 
                      00108 #define ADIE    INTECON,6
                      00109 #define T2IE    INTECON,5
                      00110 #define KBIE    INTECON,4
                      00111 #define INT1IE  INTECON,3
                      00112 #define INT0IE  INTECON,2
                      00113 #define T1IE    INTECON,1
                      00114 #define T0IE    INTECON,0
                      00115 
                      00116 ;----- INTEFLAG Bits --------------------------
                      00117 
                      00118 #define ADIF    INTF,6
                      00119 #define T2IF    INTF,5
                      00120 #define KBIF    INTF,4
                      00121 #define INT1IF  INTF,3
                      00122 #define INT0IF  INTF,2
                      00123 #define T1IF    INTF,1
                      00124 #define T0IF    INTF,0
                      00125 
                      00126 
                      00127 ;----- T0CR  Bits ----------------
                      00128 #define TC0EN   T0CR,7
                      00129 #define PWM0OE  T0CR,6
                      00130 #define BUZ0OE  T0CR,5
                      00131 
                      00132 
                      00133 ;----- T1CR  Bits ----------------
                      00134 #define TC1EN   T1CR,7
                      00135 #define PWM1OE  T1CR,6
                      00136 #define BUZ1OE  T1CR,5
                      00137 
                      00138 ;----- OSCM  Bits ----------------
                      00139 #define STBL    OSCM,5
                      00140 #define STBH    OSCM,4
                      00141 #define CLKS    OSCM,2
                      00142 #define LFEN    OSCM,1
                      00143 #define HFEN    OSCM,0
                      00144 
                      00145 
                      00146 ;-----  LVDCR Bits -------
                      00147 #define LVD     PLVDCR,7
                      00148 #define LVDS    PLVDCR,6
                      00149 ;***********DDR1 DDR2 **********
                      00150 #define DDR10   DDR1,0
                      00151 #define DDR11   DDR1,1
                      00152 #define DDR12   DDR1,2
                      00153 #define DDR13   DDR1,3
                      00154 
                      00155 
                      00156 ;----------ADC------------
                      00157 #define AIN0            0<<4
                      00158 #define AIN1            1<<4
                      00159 #define AIN2            2<<4
                      00160 #define AIN3            3<<4
                      00161 #define AIN4            4<<4
                      00162 #define AIN5            5<<4
                      00163 #define VDD_DIV3                        6<<4
                      00164 #define VOUTV_DIV3              7<<4
                      00165 
                      00166 
                      00167 #define FSYS_DIV16              0<<2
                      00168 #define FSYS_DIV8               1<<2
                      00169 #define FSYS_DIV4               2<<2
                      00170 #define FSYS_DIV2               3<<2
                      00171 
                      00172 #define ADEOC           ADCR0,1
                      00173 #define ADON            ADCR0,0
                      00174 
                      00175 #define VRES            ADCR1,3
                      00176 #define VRS0            ADCR1,0
                      00177 ;#define        inca    addai 1
                      00178 
                      00179 
                      00180 ;----timer0------------
                      00181 
                      00182 #define TC2EN                           T2CR,7
                      00183 
                      00184 
                      00185 #define T0PR_DIV1               0<<0
                      00186 #define T0PR_DIV2               1<<0
                      00187 #define T0PR_DIV4               2<<0
                      00188 #define T0PR_DIV8               3<<0
                      00189 #define T0PR_DIV16              4<<0
                      00190 #define T0PR_DIV32              5<<0
                      00191 #define T0PR_DIV64              6<<0
                      00192 #define T0PR_DIV128             7<<0
                      00193 
                      00194 #define T0PTS_FCPU                      0<<3
                      00195 #define T0PTS_FHOSC                     1<<3
                      00196 #define T0PTS_FLOSC                     2<<3
                      00197 #define T0PTS_INT0                      3<<
                      00004 
                      00005 
                      00006 #define     RAM_first_size  0x80
                      00007   
                      00008 
                      00009 
                      00010 cblock  0x0
                      00011     acc_temp            ;save the ACC value
                      00012     status_temp             ;save the ACC status
                      00013  work01
                      00014  work02
                      00015  work03 
                      00016 
                      00017 endc
                      00018 
                      00019         org 0x00
0000   A000           00020         goto    main
                      00021 
                      00022         org 0x8
0008                  00023 intport:
0008   5600           00024         movra   acc_temp            ;save the ACC status
0009   4587           00025         swapar  STATUS              ;save the CPU status
000A   5601           00026         movra   status_temp 
                      00027 ;int_t0:
                      00028 ;        jbset   T0IE
                      00029 ;        goto    int_t1
                      00030 ;        jbset   T0IF
                      00031 ;        goto    int_t1
                      00032 ;        bclr    T0IF
                      00033 ;        ;---
                      00034 ;
                      00035 ;
                      00036 ;int_t1:        
                      00037 ;        jbset   T1IE
                      00038 ;        goto    int_kbi
                      00039 ;        jbset   T1IF
                      00040 ;        goto    int_kbi
                      00041 ;        bclr    T1IF
                      00042 ;        ;---
                      00043 ;        jbset   IOP1,3
                      00044 ;        goto    set_p13_h
                      00045 ;        bclr    IOP1,3
                      00046 ;        goto    int_kbi
                      00047 ;set_p13_h:        
                      00048 ;        bset    IOP1,3         
                      00049 ;
                      00050 ;int_kbi:
                      00051 ;        jbset   KBIE
                      00052 ;        goto    int_int0
                      00053 ;        jbset   KBIF
                      00054 ;        goto    int_int0        
                      00055 ;        bclr    KBIF    
                      00056 ;        incr    work01
                      00057 ;         
                      00058 ;int_int0:
                      00059 ;        jbset   INT0IE
                      00060 ;        goto    int_int1
                      00061 ;        jbset   INT0IF
                      00062 ;        goto    int_int1
                      00063 ;        bclr    INT0IF
                      00064 ;        ;-----
                      00065 ;
                      00066 ; 
                      00067 ;int_int1:
                      00068 ;        jbset   INT1IE
                      00069 ;        goto    end_int
                      00070 ;        jbset   INT1IF
                      00071 ;        goto    end_int
                      00072 ;        bclr    INT1IF
                      00073 ;        ;----        
                      00074 ;        jbset   IOP1,2
                      00075 ;        goto    set_p12_h
                      00076 ;        bclr    IOP1,2
                      00077 ;        goto    end_int
                      00078 ;set_p12_h:        
                      00079 ;        bset    IOP1,2        
000B                  00080 end_int:        
000B   4401           00081         swapar  status_temp
000C   5787           00082         movra   STATUS
000D   5800           00083         movar   acc_temp
000E   000D           00084         retie
                      00085 
000F                  00086 main:
000F   DF88           00087         bclr    GIE
0010   3CAA           00088         movai   0xaa
0011   5600           00089         movra   0x00
0012   8000           00090         call    fn_ram_test
                      00091         
                      00092         ;rom reading funtion test
0013   3CF0           00093         movai   0xf0
0014   5784           00094         movra   FSR0
0015   3C03           00095         movai   0x03
0016   5785           00096         movra   FSR1
0017   5989           00097         movar   INDF3
0018   3A55           00098         isubai  0x55
0019   E587           00099         jbset   Z
001A   A000           00100         goto    flag_error
001B   6784           00101         incr    FSR0
001C   5989           00102         movar   INDF3
001D   3A44           00103         isubai  0x44
001E   E587           00104         jbset   Z
001F   A000           00105         goto    flag_error        
0020   6784           00106         incr    FSR0
0021   5989           00107         movar   INDF3
0022   3A56           00108         isubai  0x56
0023   E587           00109         jbset   Z
0024   A000           00110         goto    flag_error
                      00111         ;PC test
0025   7602           00112         clrr    work01
0026                  00113 look_next_data:        
0026   6602           00114         incr    work01
0027   5802           00115         movar   work01
0028   8000           00116         call    pc_test_tab
0029   4802           00117         rsubar  work01
002A   E587           00118         jbset   Z
002B   A000           00119         goto    flag_error
002C   5802           00120         movar   work01
002D   3A04           00121         isubai  0x04
002E   E587           00122         jbset   Z
002F   A000           00123         goto    look_next_data
                      00124         
                      00125         
0030   A000           00126         goto    funtion_initial
0031                  00127 flag_error:
0031   A000           00128         goto    $        
0032                  00129 funtion_initial:
                      00130         ;8 levers stack test
0032   8000           00131         call    fun001
                      00132         
0033   3C00           00133         movai   0x00
0034   5790           00134         movra   IOP0
0035   5794           00135         movra   IOP1
0036   5791           00136         movra   OEP0
0037   5795           00137         movra   OEP1
                      00138         
0038   3CFF           00139         movai   0xff
0039   5792           00140         movra   PUP0
003A   5796           00141         movra   PUP1        
003B                  00142 loop:
                      00143         ;incr    work01
                      00144         ;movar   work01
                      00145         ;movra   IOP1
                      00146         ;movra   IOP0
003B   5994           00147         movar   IOP1
003C   5990           00148         movar   IOP0
                      00149         
003D   A000           00150         goto    loop        
                      00151 
                      00152 ;----------------------------------------------
                      00153 ;       ram test
                      00154 ;  write & read all ram 
                      00155 ;
                      00156 ;-----------------------------------------------        
003E                  00157 fn_ram_test:
                      00158 
003E                  00159 ram_w:
003E   7784           00160         clrr     FSR0
                      00161         ;clrr    FSR1
                      00162 #ifdef RAM_first_size        
003F                  00163 ram_w_first:        
003F   6784           00164         incr    FSR0        
0040   5984           00165         movar   FSR0
0041   5780           00166         movra   INDF0        
0042   3A7F           00167         isubai  RAM_first_size-1
0043   E587           00168         jbset   Z
0044   A000           00169         goto    ram_w_first
                      00170 #endif
                      00171 #ifdef RAM_second_size        
                      00172 ram_w_second: ;        0x100--0x1af
                      00173         incr    FSR1        
                      00174         movar   FSR1
                      00175         movra   INDF1        
                      00176         isubai  RAM_second_size-1
                      00177         jbset   Z
                      00178         goto    ram_w_second
                      00179 #ENDIF
                      00180 #ifdef  RAM_third_size        
                      00181         clrr    FSR0
                      00182         movai   0x02
                      00183         movra   FSR1
                      00184 ram_w_thr:
                      00185         incr    FSR0    ;0x200--0x3ff
                      00186         movar   FSR0
                      00187         movra   INDF2        
                      00188         isubai  RAM_third_size-1
                      00189         jbset   Z
                      00190         goto    ram_w_thr
                      00191         incr    FSR1
                      00192         movar   FSR1
                      00193         isubai  0x04
                      00194         jbset   Z
                      00195         goto    ram_w_thr
                      00196 #ENDIF        
                      00197 ;check data
                      00198 
0045   7784           00199         clrr    FSR0
                      00200 #ifdef  RAM_first_size        
0046                  00201 ram_first_check:
                      00202         
0046   6784           00203         incr    FSR0
0047   5980           00204         movar   INDF0                
0048   5984           00205         movar   FSR0
0049   4980           00206         rsubar  INDF0
004A   E587           00207         jbset   Z ;if D_w==D_read
004B   A000           00208         goto    flag_error
004C   5984           00209         movar   FSR0        
004D   3A7F           00210         isubai  RAM_first_size-1
004E   E587           00211         jbset   Z        
004F   A000           00212         goto    ram_first_check
                      00213 #ENDIF
                      00214 #ifdef  RAM_second_size        
                      00215         ;0X100--0X1af
                      00216         clrr    FSR1
                      00217 ram_check_second: ;        0x100--0x1af
                      00218         incr    FSR1        
                      00219         movar   FSR1
                      00220         
                      00221         rsubar   INDF1
                      00222         jbset   Z
                      00223         goto    flag_error
                      00224         movar   FSR1        
                      00225         isubai  0xaf
                      00226         jbset   Z
                      00227         goto    ram_check_second
                      00228 #ENDIF
                      00229 #ifdef  RAM_third_size        
                      00230         ;0x200--0x3ff
                      00231         clrr    FSR0
                      00232         movai   0x02
                      00233         movra   FSR1
                      00234 ram_check_thr:
                      00235         incr    FSR0    ;0x200--0x3ff
                      00236         movar   FSR0
                      00237         rsubar   INDF2 
                      00238         jbset   Z
                      00239         goto    flag_error
                      00240         movar   FSR0
                      00241         isubai  0xff
                      00242         jbset   Z
                      00243         goto    ram_check_thr
                      00244         incr    FSR1
                      00245         movar   FSR1
                      00246         isubai  0x04
                      00247         jbset   Z
                      00248         goto    ram_check_thr        
                      00249         ;end ram_w
                      00250 #endif                
0050                  00251 ram_clr:
0050   7784           00252         clrr     FSR0
                      00253         ;clrr    FSR1
                      00254 #ifdef  RAM_first_size        
0051                  00255 ram_clr_first:        
0051   6784           00256         incr    FSR0        
0052   5984           00257         movar   FSR0
0053   7780           00258         clrr    INDF0        
0054   3A7F           00259         isubai  RAM_first_size-1
0055   E587           00260         jbset   Z
0056   A000           00261         goto    ram_clr_first
                      00262 #ENDIF
                      00263 #ifdef  RAM_second_size        
                      00264         ;0X100--0X1af
                      00265         clrr    FSR1
                      00266 ram_clr_second: ;        0x100--0x1af
                      00267         incr    FSR1        
                      00268         movar   FSR1
                      00269         clrr   INDF1        
                      00270         isubai  0xaf
                      00271         jbset   Z
                      00272         goto    ram_clr_second
                      00273 #endif 
                      00274 #ifdef  RAM_third_size                
                      00275         clrr    FSR0
                      00276         movai   0x02
                      00277         movra   FSR1
                      00278 ram_clr_thr:
                      00279         incr    FSR0    ;0x200--0x3ff
                      00280         movar   FSR0
                      00281         clrr   INDF2        
                      00282         isubai  0xff
                      00283         jbset   Z
                      00284         goto    ram_clr_thr
                      00285         incr    FSR1
                      00286         movar   FSR1
                      00287         isubai  0x04
                      00288         jbset   Z
                      00289         goto    ram_clr_thr
                      00290 #endif        
                      00291 
0057   000C           00292         return
                      00293 
                      00294 
0058                  00295 fun001:
0058   6602           00296         incr    work01
0059   8000           00297         call    fun002
005A   000C           00298         return
005B                  00299 fun002:
005B   6602           00300         incr    work01
005C   8000           00301         call    fun003
005D   000C           00302         return
005E                  00303 fun003:
005E   6602           00304         incr    work01
005F   8000           00305         call    fun004
0060   000C           00306         return
0061                  00307 fun004:
0061   6602           00308         incr    work01        
0062   8000           00309         call    fun005
0063   000C           00310         return
0064                  00311 fun005:
0064   6602           00312         incr    work01
0065   8000           00313         call    fun006
0066   000C           00314         return
0067                  00315 fun006:
0067   6602           00316         incr    work01
0068   8000           00317         call    fun007
0069   000C           00318         return
006A                  00319 fun007:
006A   6602           00320         incr    work01
006B   8000           00321         call    fun008
006C   000C           00322         return        
006D                  00323 fun008:
006D   6602           00324         incr    work01
                      00325         ;call    fun009 ; 
006E   000C           00326         return
006F                  00327 fun009:
006F   6602           00328         incr    work01
0070   000C           00329         return       
                      00330         
                      00331         org 0x2fd
02FD                  00332 pc_test_tab:        
02FD   7F86           00333         addra   PCL
02FE   3B00           00334         retai   0x00
02FF   3B01           00335         retai   0x01
0300   3B02           00336         retai   0x02
0301   3B03           00337         retai   0x03
0302   3B04           00338         retai   0x04
                      00339         
                      00340         org 0x3f0
03F0   AA55 3344 1256 00341         dw 0xaa55,0x3344,0x1256,0x7890        
       7890           
                      00342 
                      00343         end       
gpasm-1.4.0 (Sep 22 2013)    test.asm           2013-11-22  10:34:41         PAGE  2


SYMBOL TABLE
  LABEL                             VALUE

AAAA_R00                          0000018C
AA_R0                             000001AD
AA_R2                             000001AF
AA_R4                             000001AB
ADCR0                             000001B0
ADCR1                             000001B1
ANSEL                             00000193
FSR0                              00000184
FSR1                              00000185
HIBYTE                            00000183
INDF0                             00000180
INDF1                             00000181
INDF2                             00000182
INDF3                             00000189
INTE                              0000018A
INTF                              0000018B
INVALID_ADDR1                     0000018D
INVALID_ADDR2                     0000018E
INVALID_ADDR3                     0000018F
INVALID_ADDR5                     00000198
INVALID_ADDR6                     00000199
INVALID_ADDR7                     0000019A
INVALID_ADDR8                     0000019B
INVALID_ADDR9                     0000019C
INVALID_ADDRA                     0000019D
INVALID_ADDRB                     0000019E
INVALID_ADDRC                     0000019F
IOP0                              00000190
IOP1                              00000194
KBIM                              00000197
MCR                               00000188
OEP0                              00000191
OEP1                              00000195
OSCM                              000001AE
PCL                               00000186
PFALG                             00000187
PUP0                              00000192
PUP1                              00000196
PWMCR                             000001AC
T0CNT                             000001A1
T0CR                              000001A0
T0DATA                            000001A3
T0LOAD                            000001A2
T1CNT                             000001A5
T1CR                              000001A4
T1DATA                            000001A7
T1LOAD                            000001A6
T2CNT                             000001A9
T2CR                              000001A8
T2LOAD                            000001AA
_.org_8_0031                      00000031
__32P21                           00000001
acc_temp                          00000000
end_int                           0000000B
flag_error                        00000031
fn_ram_test                       0000003E
fun001                            00000058
fun002                            0000005B
fun003                            0000005E
fun004                            00000061
fun005                            00000064
fun006                            00000067
fun007                            0000006A
fun008                            0000006D
fun009                            0000006F
funtion_initial                   00000032
intport                           00000008
look_next_data                    00000026
loop                              0000003B
main                              0000000F
pc_test_tab                       000002FD
ram_clr                           00000050
ram_clr_first                     00000051
ram_first_check                   00000046
ram_w                             0000003E
ram_w_first                       0000003F
status_temp                       00000001
work01                            00000002
work02                            00000003
work03                            00000004
ADEOC                             ADCR0,1
ADIE                              INTECON,6
ADIF                              INTF,6
ADON                              ADCR0,0
ADRH                              0X1B4
ADRL                              0X1B5
AIN0                              0<<4
AIN1                              1<<4
AIN2                              2<<4
AIN3                              3<<4
AIN4                              4<<4
AIN5                              5<<4
BUZ0OE                            T0CR,5
BUZ1OE                            T1CR,5
C                                 STATUS,0
CLKS                              OSCM,2
DC                                STATUS,1
DDR10                             DDR1,0
DDR11                             DDR1,1
DDR12                             DDR1,2
DDR13                             DDR1,3
FSYS_DIV16                        0<<2
FSYS_DIV2                         3<<2
FSYS_DIV4                         2<<2
FSYS_DIV8                         1<<2
GIE                               MCR,7
HFEN                              OSCM,0
INDF                              INDF0
INT0IE                            INTECON,2
INT0IF                            INTF,2
INT1IE                            INTECON,3
INT1IF                            INTF,3
INTECON                           INTE
KBIE                              INTECON,4
KBIF                              INTF,4
LFEN                              OSCM,1
LVD                               PLVDCR,7
LVDS                              PLVDCR,6
OSCCAL                            0X1FB
PWM0OE                            T0CR,6
PWM1OE                            T1CR,6
RAM_first_size                    0x80
STATUS                            PFALG
STBH                              OSCM,4
STBL                              OSCM,5
T0IE                              INTECON,0
T0IF                              INTF,0
T0PR_DIV1                         0<<0
T0PR_DIV128                       7<<0
T0PR_DIV16                        4<<0
T0PR_DIV2                         1<<0
T0PR_DIV32                        5<<0
T0PR_DIV4                         2<<0
T0PR_DIV64                        6<<0
T0PR_DIV8                         3<<0
T0PTS_FCPU                        0<<3
T0PTS_FHOSC                       1<<3
T0PTS_FLOSC                       2<<3
T0PTS_INT0                        3<<3
T1IE                              INTECON,1
T1IF                              INTF,1
T2IE                              INTECON,5
T2IF                              INTF,5
TC0EN                             T0CR,7
TC1EN                             T1CR,7
TC2EN                             T2CR,7
VDD_DIV3                          6<<4
VOUTV_DIV3                        7<<4
VRES                              ADCR1,3
VRS0                              ADCR1,0
Z                                 STATUS,2

Errors   :     0
Warnings :     0 reported,     0 suppressed
Messages :     0 reported,     0 suppressed

