gpasm-0.9.0 (Feb 20 2013)    temp_timer.asm     2013-2-28  10:03:18          PAGE  1


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00001 
                      00002 ; mc32p21 timer test funtion
                      00003 ; timer.asm
                      00004 
                      00005 #define SECONDS_PER_YEAR (60*60*24*365)UL
                      00006 
                      00007 #include "mc32p21.inc"
                      00001         ;LIST
                      00002 ;MC30P01A.INC  Standard Header File, Version 1.00 by Sinomcu
                      00003         ;NOLIST
                      00004 
                      00005 
                      00006 ;==========================================================================
                      00007 ;
                      00008 ;       Revision History
                      00009 ;
                      00010 ;==========================================================================
                      00011 
                      00012 ;Rev:   Date:    Reason:
                      00013 
                      00014 ;1.00   12/06/21 Initial Release
                      00015 
                      00016 ;==========================================================================
                      00017 ;
                      00018 ;       Verify Processor
                      00019 ;
                      00020 ;==========================================================================
                      00021 
                      00022         ;IFNDEF __30P44
                      00023         ;   MESSG "Processor-header file mismatch.  Verify selected processor."
                      00024         ;ENDIF
                      00025 
                      00026 ;==========================================================================
                      00027 ;
                      00028 ;       Register Definitions
                      00029 ;
                      00030 ;==========================================================================
                      00031 
                      00032 ;W                            EQU     H'0000'
                      00033 ;F                            EQU     H'0001'
                      00034 
                      00035 ;----- Register Files------------------------------------------------------
                      00036 cblock  0x180
                      00037 INDF0                   
                      00038 INDF1                   
                      00039 INDF2                   
                      00040 HIBYTE                  
                      00041 FSR0                    
                      00042 FSR1                    
                      00043 PCL                     
                      00044 PFALG                   
                      00045 ;----0x188
                      00046 MCR                     
                      00047 INDF3                   
                      00048 INTE0                   
                      00049 INTF0                   
                      00050 INVALID_ADDR0           
                      00051 INVALID_ADDR1           
                      00052 INVALID_ADDR2           
                      00053 INVALID_ADDR3           
                      00054 ;----0x190
                      00055 IOP0                    
                      00056 OEP0                    
                      00057 PUP0           
                      00058 ANSEL
                      00059 IOP1                      
                      00060 OEP1                    
                      00061 PUP1                    
                      00062 KBIM           
                      00063 ;-----0x198                        
                      00064 INVALID_ADDR5                      
                      00065 INVALID_ADDR6                    
                      00066 INVALID_ADDR7           
                      00067 INVALID_ADDR8           
                      00068 INVALID_ADDR9           
                      00069 INVALID_ADDRA           
                      00070 INVALID_ADDRB           
                      00071 INVALID_ADDRC           
                      00072 ;-----0x1a0
                      00073 T0CR                    
                      00074 T0CNT                   
                      00075 T0LOAD                  
                      00076 T0DATA                  
                      00077 T1CR                    
                      00078 T1CNT                   
                      00079 T1LOAD                  
                      00080 T1DATA                  
                      00081 ;-----0x1a8                        
                      00082 UCR                     
                      00083 UBR                     
                      00084 UFR                     
                      00085 UTR                     
                      00086 URR                     
                      00087 LVDCR                   
                      00088 OSCM                    
                      00089 POWCR                   
                      00090 ;-----0x1b0
                      00091 ADCR0                   
                      00092 ADCR1                   
                      00093 ADCR2                   
                      00094 ADCR3                   
                      00095 ADRH                    
                      00096 ADRM                    
                      00097 ADRL                    
                      00098 INVALID_ADDRD           
                      00099 ;----0x1b8                        
                      00100 LCDCR0                  
                      00101 LCDCR1                  
                      00102 LCDIOS                  
                      00103 INVALID_ADDRE           
                      00104 INVALID_ADDRF           
                      00105 INVALID_ADDR10          
                      00106 INVALID_ADDR11          
                      00107 INVALID_ADDR12          
                      00108 ;----0x1c0
                      00109 LCDDS0                  
                      00110 LCDDS1                  
                      00111 LCDDS2                  
                      00112 LCDDS3                  
                      00113 LCDDS4                  
                      00114 LCDDS5                  
                      00115 LCDDS6                  
                      00116 LCDDS7                  
                      00117 ;----0x1c8                        
                      00118 LCDDS8                  
                      00119 LCDDS9                  
                      00120 LCDDSa                  
                      00121 LCDDSb                  
                      00122 LCDDSc                  
                      00123 LCDDSd                  
                      00124 LCDDSe                  
                      00125 LCDDSf                  
                      00126 endc
  000001F3            00127 OSCCAL          equ     0x1f3
                      00128 
                      00129 #define         STATUS          PFALG
                      00130 #define         INDF            INDF0
                      00131 #define         FSR             FSR0
                      00132 #define         P0HCON          PUP0
                      00133 #define         P1HCON          PUP1
                      00134 #define         INTECON         INTE0
                      00135 #define         INTEFLAG        INTF0   
                      00136 #define         LCDDS10         LCDDSa
                      00137 #define         LCDDS11         LCDDSb
                      00138 #define         LCDDS12         LCDDSc
                      00139 #define         LCDDS13         LCDDSc
                      00140 #define         LCDDS14         LCDDSe
                      00141 #define         LCDDS15         LCDDSf
                      00142 
                      00143 ;----- STATUS Bits --------------------------
                      00144 #define Z       STATUS,2
                      00145 #define DC      STATUS,1
                      00146 #define C       STATUS,0
                      00147 
                      00148 ;----- MCR Bits --------------------------
                      00149 #define GIE     MCR,7
                      00150 
                      00151 ;-----  P2HCON Bits -----------------------
                      00152 #define P20PH   P2HCON,0
                      00153 #define P21PH   P2HCON,1
                      00154 #define P22PH   P2HCON,2
                      00155 #define P23PH   P2HCON,3
                      00156 #define P24PH   P2HCON,4
                      00157 #define P25PH   P2HCON,5
                      00158 #define P26PH   P2HCON,6
                      00159 #define P27PH   P2HCON,7
                      00160 ;----- INTECON Bits --------------------------
                      00161 #define INTE    INTECON
                      00162 #define ADIE    INTECON,6
                      00163 #define KBIE    INTECON,4
                      00164 #define INT1IE  INTECON,3
                      00165 #define INT0IE  INTECON,2
                      00166 #define T1IE    INTECON,1
                      00167 #define T0IE    INTECON,0
                      00168 
                      00169 ;----- INTEFLAG Bits --------------------------
                      00170 #define INTF    INTEFLAG
                      00171 #define ADIF    INTF,6
                      00172 #define KBIF    INTF,4
                      00173 #define INT1IF  INTF,3
                      00174 #define INT0IF  INTF,2
                      00175 #define T1IF    INTF,1
                      00176 #define T0IF    INTF,0
                      00177 ;----- UCR Bits--------------------------
                      00178 #define OPEN    UCR,4
                      00179 #define EPEN    UCR,3
                      00180 #define UARTEN  UCR,2
                      00181 ;----- UFR ----------------------
                      00182 #define FREF    UFR,7
                      00183 #define PAEF    UFR,6
                      00184 #define OVEF    UFR,5
                      00185 #define TSEF    UFR,4
                      00186 #define RDAF    UFR,1
                      00187 #define TREF    UFR,0
                      00188 ;---- ADCR0 Bits -----------------
                      00189 #define    ADCKS_16     0<<1    ;Fcpu/16
                      00190 #define    ADCKS_8      1<<1    ;Fcpu/8
                      00191 #define    ADCKS_4      2<<1    ;Fcpu/4
                      00192 #define    ADCKS_2      2<<1    ;Fcpu/2
                      00193 #define    ADCHS_0      0<<4    ;AN0
                      00194 #define    ADCHS_1      1<<4    ;AN1
                      00195 #define    ADCHS_2      2<<4    ;AN2
                      00196 #define    ADCHS_3      3<<4    ;AN3
                      00197 #define    ADCHS_4      4<<4    ;AN4
                      00198 #define    ADCHS_5      5<<4    ;AN5
                      00199 #define    ADCHS_6      6<<4    ;AN6
                      00200 #define ADEN    ADCR0,0
                      00201 #define ADEOC   ADCR0,3
                      00202 ;---- ADCR1 Bits -----------------
                      00203 #define    ADV_ADD      3       ;VDD
                      00204 #define    ADV_4V       2       ;4V
                      00205 #define    ADV_3V       1       ;3V
                      00206 #define    ADV_2V       0       ;2V
                      00207 #define    ADV_EX       4       ;外部参考电压
                      00208 ;----- LCDCR0 Bits --------------------------
                      00209 #define LCDEN   LCDCR0,7
                      00210 #define VLCDS   LCDCR0,3
                      00211 ;----- T0CR  Bits ----------------
                      00212 #define TC0EN   T0CR,7
                      00213 #define PWM0OUT T0CR,6
                      00214 #define BUZ0OUT T0CR,5
                      00215 
                      00216 ;----- T1CR  Bits ----------------
                      00217 #define TC1EN   T1CR,7
                      00218 #define PWM1OUT T1CR,6
                      00219 #define BUZ1OUT T1CR,5
                      00220 
                      00221 ;----- OSCM  Bits ----------------
                      00222 #define STBL    OSCM,5
                      00223 #define STBH    OSCM,4
                      00224 #define CLKS    OSCM,2
                      00225 #define LFEN    OSCM,1
                      00226 #define HFEN    OSCM,0
                      00227 
                      00228 ;-----  POWCR Bits -------
                      00229 #define LDOEN   POWCR,7
                      00230 #define ENB     POWCR,6
                      00231 ;-----  LVDCR Bits -------
                      00232 #define LVD     PLVDCR,7
                      00233 #define LVDS    PLVDCR,6
                      00234 ;***********DDR1 DDR2 **********
                      00235 #define DDR10   DDR1,0
                      00236 #define DDR11   DDR1,1
                      00237 #define DDR12   DDR1,2
                      00238 #define DDR13   DDR1,3
                      00239 
                      00240 #define DDR20   DDR2,0
                      00241 #define DDR21   DDR2,1
                      00242 #define DDR22   DDR2,2
                      00243 #define DDR23   DDR2,3
                      00244 #define DDR24   DDR2,4
                      00245 #define DDR25   DDR2,5
                      00246 #define DDR26   DDR2,6
                      00247 #define DDR27   DDR2,7
                      00248 ;******************************
                      00249 
                      00250 
                      00251 ;#define        inca    addai 1
                      00008 
                      00009 cblock 0x00
                      00010 r0
                      00011 r1
                      00012 r2
                      00013 r3
                      00014 acc_temp
                      00015 status_temp
                      00016 model_flag1
                      00017 model_flag2
                      00018 
                      00019 
                      00020 
                      00021 endc
                      00022 
                      00023 #define model00         model_flag1,0
                      00024 #define model01         model_flag1,1
                      00025 #define model02         model_flag1,2
                      00026 #define model03         model_flag1,3
                      00027 #define model04         model_flag1,4
                      00028 #define model05         model_flag1,5
                      00029 #define model06         model_flag1,6
                      00030 #define model07         model_flag1,7
                      00031 #define model08         model_flag2,0
                      00032 #define model09         model_flag2,1
                      00033 #define model0a         model_flag2,2
                      00034 #define model0b         model_flag2,3
                      00035 #define model0c         model_flag2,4
                      00036 #define model0d         model_flag2,5
                      00037 #define model0e         model_flag2,6
                      00038 #define model0f         model_flag2,7
                      00039 
                      00040 
                      00041 
                      00042 
                      00043         org  0x0000
0000   A000           00044         goto start
                      00045         
                      00046         org 0x08
0008                  00047 fun_interrupt:
0008   5604           00048         movra   acc_temp
0009   4587           00049         swapar  STATUS
000A   5605           00050         movra   status_temp
                      00051 ;judgement int source
000B                  00052 start_just_int:
000B   F18A           00053         jbclr    T0IE
000C   E18B           00054         jbset    T0IF
000D   A000           00055         goto     lab_if_timer1_int
                      00056 ;----timer0-----------------------
000E   D18B           00057         bclr    T0IF
000F   D390           00058         bclr    IOP0,1
0010   C390           00059         bset    IOP0,1
0011                  00060 end_time0_interrupt:
                      00061 ;---------------------------------
0011                  00062 lab_if_timer1_int:        
0011   F38A           00063         jbclr    T1IE
0012   E38B           00064         jbset    T1IF
0013   A000           00065         goto    just_int0        
                      00066 ;*********timer1***********
0014   D38B           00067     bclr    T1IF
                      00068     ;incr    time_125us
                      00069     ;jbset    time_125us,3
0015   D190           00070     bclr        IOP0,0
0016   C190           00071     bset        IOP0,0
0017   A000           00072     goto        end_time1_interrupt
                      00073 
0018                  00074 end_time1_interrupt:
                      00075 ;**********end_timer1******
0018                  00076 just_int0:
0018   F58A           00077     jbclr    INT0IE
0019   E58B           00078     jbset    INT0IF
001A   A000           00079     goto     just_int1
                      00080 ;**********int0************
001B   D58B           00081     bclr    INT0IF
                      00082     
                      00083 ;*********end int0*********
001C                  00084 just_int1:
001C   F78A           00085     jbclr    INT1IE
001D   E78B           00086     jbset    INT1IF
001E   A000           00087     goto     just_adc
                      00088 ;**********int0************
001F   D78B           00089     bclr    INT1IF
                      00090 
                      00091 ;*********end int1*********
0020                  00092 just_adc:
0020   FD8A           00093      jbclr      ADIE
0021   ED8B           00094      jbset      ADIF
0022   A000           00095      goto       just_kbim
                      00096 ;***********adc ***********
0023   DD8B           00097      bclr       ADIF
                      00098 ;***********end adc********
0024                  00099 just_kbim:
0024   F98A           00100     jbclr    KBIE
0025   E98B           00101     jbset    KBIF
0026   A000           00102     goto    end_just_int
                      00103 ;**********kbim************
0027   D98B           00104     bclr    KBIF
                      00105 
                      00106 ;**********end_kbim********
0028                  00107 end_just_int:
0028                  00108 exit_interrupt:
0028   4405           00109     swapar    status_temp
0029   5787           00110     movra    STATUS
002A   4604           00111     swapr    acc_temp
002B   4404           00112     swapar    acc_temp
002C   000D           00113     retie
                      00114 
002D                  00115 start:
002D   3CA0           00116         movai   0xa0
002E   5600           00117         movra   r0
002F   3CA3           00118         movai   0xa3
0030   5601           00119         movra   r1
                      00120         
                      00121         
0031   DF88           00122         bclr     GIE
0032   3CFF           00123         movai   0Xff
0033   5791           00124         movra   OEP0    ;as output
0034   3C3F           00125         movai   0x3f
0035   5795           00126         movra   OEP1    ; p16 as input 
0036   3CFF           00127         movai   0xff       
0037   5792           00128         movra  PUP0
0038   5796           00129         movra  PUP1
                      00130         
0039   3C7F           00131         movai   0x7f
003A   5784           00132         movra   FSR0
                      00133 
003B                  00134 lab_clr_ram:        
003B   7780           00135         clrr    INDF0
                      00136         ;decr    FSR0
003C   6B84           00137         djzr    FSR0 ;FRS0-1=0,skip next instruction
003D   A000           00138         goto    lab_clr_ram 
003E   7780           00139         clrr    INDF0   ;clr 0x00 addr
                      00140         
003F   3CC0           00141                 movai   11000000b ; enable t0,pwm t0pts=0,t0pr=0
0040   57A0           00142         movra   T0CR
                      00143         ;movai   11000001b ; enable t0,pwm t0pts=0,t0pr=0
0041   57A4           00144         movra   T1CR
                      00145         
0042   3CFF           00146         movai   0xff
0043   57A2           00147         movra   T0LOAD
0044   57A6           00148         movra   T1LOAD
0045   3C7F           00149         movai   0x7f
0046   57A3           00150         movra   T0DATA ;pwm H time seting
0047   57A7           00151         movra   T1DATA
                      00152         
0048   C18A           00153         bset    T0IE
                      00154         ;bset    T1IE
0049   CF88           00155         bset    GIE
                      00156         
004A                  00157 loop:
004A   0000           00158         nop
                      00159 
004B   A000           00160         goto loop
                      00161         
                      00162 
                      00163         end   
gpasm-0.9.0 (Feb 20 2013)    temp_timer.asm     2013-2-28  10:03:18          PAGE  2


SYMBOL TABLE
  LABEL                             VALUE

ADCR0                             000001B0
ADCR1                             000001B1
ADCR2                             000001B2
ADCR3                             000001B3
ADRH                              000001B4
ADRL                              000001B6
ADRM                              000001B5
ANSEL                             00000193
FSR0                              00000184
FSR1                              00000185
HIBYTE                            00000183
INDF0                             00000180
INDF1                             00000181
INDF2                             00000182
INDF3                             00000189
INTE0                             0000018A
INTF0                             0000018B
INVALID_ADDR0                     0000018C
INVALID_ADDR1                     0000018D
INVALID_ADDR10                    000001BD
INVALID_ADDR11                    000001BE
INVALID_ADDR12                    000001BF
INVALID_ADDR2                     0000018E
INVALID_ADDR3                     0000018F
INVALID_ADDR5                     00000198
INVALID_ADDR6                     00000199
INVALID_ADDR7                     0000019A
INVALID_ADDR8                     0000019B
INVALID_ADDR9                     0000019C
INVALID_ADDRA                     0000019D
INVALID_ADDRB                     0000019E
INVALID_ADDRC                     0000019F
INVALID_ADDRD                     000001B7
INVALID_ADDRE                     000001BB
INVALID_ADDRF                     000001BC
IOP0                              00000190
IOP1                              00000194
KBIM                              00000197
LCDCR0                            000001B8
LCDCR1                            000001B9
LCDDS0                            000001C0
LCDDS1                            000001C1
LCDDS2                            000001C2
LCDDS3                            000001C3
LCDDS4                            000001C4
LCDDS5                            000001C5
LCDDS6                            000001C6
LCDDS7                            000001C7
LCDDS8                            000001C8
LCDDS9                            000001C9
LCDDSa                            000001CA
LCDDSb                            000001CB
LCDDSc                            000001CC
LCDDSd                            000001CD
LCDDSe                            000001CE
LCDDSf                            000001CF
LCDIOS                            000001BA
LVDCR                             000001AD
MCR                               00000188
OEP0                              00000191
OEP1                              00000195
OSCCAL                            000001F3
OSCM                              000001AE
PCL                               00000186
PFALG                             00000187
POWCR                             000001AF
PUP0                              00000192
PUP1                              00000196
T0CNT                             000001A1
T0CR                              000001A0
T0DATA                            000001A3
T0LOAD                            000001A2
T1CNT                             000001A5
T1CR                              000001A4
T1DATA                            000001A7
T1LOAD                            000001A6
UBR                               000001A9
UCR                               000001A8
UFR                               000001AA
URR                               000001AC
UTR                               000001AB
__32P21                           00000001
acc_temp                          00000004
end_just_int                      00000028
end_time0_interrupt               00000011
end_time1_interrupt               00000018
exit_interrupt                    00000028
fun_interrupt                     00000008
just_adc                          00000020
just_int0                         00000018
just_int1                         0000001C
just_kbim                         00000024
lab_clr_ram                       0000003B
lab_if_timer1_int                 00000011
loop                              0000004A
model_flag1                       00000006
model_flag2                       00000007
r0                                00000000
r1                                00000001
r2                                00000002
r3                                00000003
start                             0000002D
start_just_int                    0000000B
status_temp                       00000005
ADCHS_0                           0<<4
ADCHS_1                           1<<4
ADCHS_2                           2<<4
ADCHS_3                           3<<4
ADCHS_4                           4<<4
ADCHS_5                           5<<4
ADCHS_6                           6<<4
ADCKS_16                          0<<1
ADCKS_2                           2<<1
ADCKS_4                           2<<1
ADCKS_8                           1<<1
ADEN                              ADCR0,0
ADEOC                             ADCR0,3
ADIE                              INTECON,6
ADIF                              INTF,6
ADV_2V                            0
ADV_3V                            1
ADV_4V                            2
ADV_ADD                           3
ADV_EX                            4
BUZ0OUT                           T0CR,5
BUZ1OUT                           T1CR,5
C                                 STATUS,0
CLKS                              OSCM,2
DC                                STATUS,1
DDR10                             DDR1,0
DDR11                             DDR1,1
DDR12                             DDR1,2
DDR13                             DDR1,3
DDR20                             DDR2,0
DDR21                             DDR2,1
DDR22                             DDR2,2
DDR23                             DDR2,3
DDR24                             DDR2,4
DDR25                             DDR2,5
DDR26                             DDR2,6
DDR27                             DDR2,7
ENB                               POWCR,6
EPEN                              UCR,3
FREF                              UFR,7
FSR                               FSR0
GIE                               MCR,7
HFEN                              OSCM,0
INDF                              INDF0
INT0IE                            INTECON,2
INT0IF                            INTF,2
INT1IE                            INTECON,3
INT1IF                            INTF,3
INTE                              INTECON
INTECON                           INTE0
INTEFLAG                          INTF0
INTF                              INTEFLAG
KBIE                              INTECON,4
KBIF                              INTF,4
LCDDS10                           LCDDSa
LCDDS11                           LCDDSb
LCDDS12                           LCDDSc
LCDDS13                           LCDDSc
LCDDS14                           LCDDSe
LCDDS15                           LCDDSf
LCDEN                             LCDCR0,7
LDOEN                             POWCR,7
LFEN                              OSCM,1
LVD                               PLVDCR,7
LVDS                              PLVDCR,6
OPEN                              UCR,4
OVEF                              UFR,5
P0HCON                            PUP0
P1HCON                            PUP1
P20PH                             P2HCON,0
P21PH                             P2HCON,1
P22PH                             P2HCON,2
P23PH                             P2HCON,3
P24PH                             P2HCON,4
P25PH                             P2HCON,5
P26PH                             P2HCON,6
P27PH                             P2HCON,7
PAEF                              UFR,6
PWM0OUT                           T0CR,6
PWM1OUT                           T1CR,6
RDAF                              UFR,1
SECONDS_PER_YEAR                  (60*60*24*365)UL
STATUS                            PFALG
STBH                              OSCM,4
STBL                              OSCM,5
T0IE                              INTECON,0
T0IF                              INTF,0
T1IE                              INTECON,1
T1IF                              INTF,1
TC0EN                             T0CR,7
TC1EN                             T1CR,7
TREF                              UFR,0
TSEF                              UFR,4
UARTEN                            UCR,2
VLCDS                             LCDCR0,3
Z                                 STATUS,2
model00                           model_flag1,0
model01                           model_flag1,1
model02                           model_flag1,2
model03                           model_flag1,3
model04                           model_flag1,4
model05                           model_flag1,5
model06                           model_flag1,6
model07                           model_flag1,7
model08                           model_flag2,0
model09                           model_flag2,1
model0a                           model_flag2,2
model0b                           model_flag2,3
model0c                           model_flag2,4
model0d                           model_flag2,5
model0e                           model_flag2,6
model0f                           model_flag2,7

Errors   :     0
Warnings :     0 reported,     0 suppressed
Messages :     0 reported,     0 suppressed

